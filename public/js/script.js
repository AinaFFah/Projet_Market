toastr.options={timeOut:5e3,progressBar:!0,showMethod:"slideDown",hideMethod:"slideUp",showDuration:200,hideDuration:200};let messages=document.querySelectorAll("#notif-message");function manovaZavatraKelyNav(e){$(".navigation li a.active").removeClass("active"),"achat"===e?$(".btnachatty").addClass("active"):"vente"===e?$(".btnventety").addClass("active"):$(".btnartty").addClass("active")}messages.forEach((e=>{"success"===e.className&&toastr.success(e.innerHTML)}));var counter_dl=0;function initDataTable(e,t=[[1,"asc"]]){return e.DataTable({colReorder:!0,drawCallback:function(){counter_dl<1&&loadConfirmDelete()},language:{paginate:{first:"Premier",last:"Dernier",next:"Suivant",previous:"Précedent"},sZeroRecords:"Rien ne corespond à vos conditions (ou recherche)",loadingRecords:"Chargement en cours...",search:"Mots clées",lengthMenu:"Nombre d' entré: _MENU_",info:"Nombre Total :<strong class='font-size-30'> _TOTAL_ <strong>",emptyTable:"Liste Vide",infoEmpty:"Rien à afficher",infoFiltered:" resultat"}}).order(t)}$("form, input").keypress((function(e){"13"==e.which&&e.preventDefault()}));let table_ext=initDataTableWithFilter($("#list_achat_externe"),[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25]),table_loc=initDataTableWithFilter($("#list_achat_locale"),[1,2,3,4,5,6,7,8,9,10,11]);function orderTable(e,t){e.order(t).draw()}function initDatePicker(e){return e.daterangepicker({singleDatePicker:!0,showDropdowns:!0,locale:{format:"DD/MM/YYYY"}})}function initEmptyDatePicker(e){return e.daterangepicker({singleDatePicker:!0,showDropdowns:!0,autoUpdateInput:!1}).on("apply.daterangepicker",(function(e,t){$(this).val(t.startDate.format("DD/MM/YYYY"))}))}function loadConfirmDelete(){counter_dl++,$(".confirmDelete").click((function(e){e.preventDefault();let t=$(this).parent(),a=t.parent().parent().parent().parent(),l=a.DataTable(),r=t.attr("action"),i=t.serialize();swal({title:"Etes-vous sure?",text:"Cette action sera irreversible !",icon:"warning",buttons:!0,dangerMode:!0}).then((e=>{e&&$.post(r,i,(function(e){if("delete_success"===e.status[0])if(a.hasClass("dataTable"))t.parent().parent().remove(),swal("C'est fait!","Suppression fait!","success"),l.row(t.parents("tr")).remove().draw();else{t.parent().parent().remove();const e=t.parent().parent().parent();0===e.children().length&&e.html('<tr>\n        <td colspan="3">Vous avez vidé la liste!</td>\n    </tr>'),swal("C'est fait!","Suppression fait!","success")}else swal("Desolée!","Vous n'avez pas droit à cette action!","error")})).fail((function(e){swal("Desolée!","Vous n'avez pas droit à cette action!","error")}))}))}))}function initSelect___(){$(".payement_select,  .initSelect").select2({multiple:!0,language:{noResults:function(){return"<div class='text-center'><span class='text-muted font-size-13'>Ooooo!!, pas de resultat! </div>"}},escapeMarkup:function(e){return e}}),$(".initSelectOne, .initSelectOne2").select2({multiple:!1,language:{noResults:function(){return"<div class='text-center'><span class='text-muted font-size-13'>Ooooo!!, pas de resultat! </div>"}},escapeMarkup:function(e){return e}})}function createThisQuickly(e,t,a=!1){let l=typedInSelect,r=new Option(l,l,!0,!0),i=a?{item:l,cat_cli:a}:{item:l};$.post(t,i,(function(t){"success"!==t.statut?swal("Erreur lors de l'ajout!","","error"):e.hasClass("azaMantanyHahaha")&&($("#modal_commande_ajout #cmd_code_cli").val(t.code_cli),$("#new_devis_form #cmd_code_cli").val(t.code_cli),$(".cateCli").prop("disabled",!0),$(".code_cli").html(t.code_cli),$(".fb2c_code_cli").html(t.code_cli),$(".fb2b_cli").html(t.cli),$(".fb2c_cli").html(t.cli),$(".fb2c_cli2").html(t.cli),$(".bl_cli").html(t.cli),politique_selection=$("#new_cmd_form select.politique"),adress_selection=$("#new_cmd_form select.lieu_livraison, select.fact_lieu_livraison"),pLink=e.attr("data-PLink"),lLink=e.attr("data-LLink"),politique_selection.select2({data:[],multiple:!1,language:{noResults:function(){return pl=pLink,typedInSelect=event.target.value,"<div class='text-center'><span class='text-muted font-size-13'>Ooooo!!, pas de resultat! <i class='fas fa-smile'></i></span><br><button type='button' onclick='createThisQuickly(politique_selection, pl)' class='btn create_this_article btn-sm btn-success'>Nouvelle politique ?</button></div>"}},escapeMarkup:function(e){return e}}),adress_selection.select2({data:[],multiple:!1,language:{noResults:function(){return ll=lLink,typedInSelect=event.target.value,"<div class='text-center'><span class='text-muted font-size-13'>Ooooo!!, pas de resultat! <i class='fas fa-smile'></i></span><br><button type='button' onclick='createThisQuickly(adress_selection, ll)' class='btn create_this_article btn-sm btn-success'>Nouvelle adresse ?</button></div>"}},escapeMarkup:function(e){return e}}))})),e.append(r).trigger("change"),e.select2("close"),typedInSelect=""}function InitDropzone(e){Dropzone.autoDiscover=!1,$("."+e).click((function(){Dropzone.autoDiscover=!1,url=$("#addPic").attr("data-link");let e=new Dropzone(".dropzone",{url:url,paramName:"pic",maxFiles:1,addRemoveLinks:!0,acceptedFiles:"image/*",autoProcessQueue:!1});e.options.dictDefaultMessage="Cliquez ou glisser votre fichier ici",e.options.dictFileTooBig="Fichier trop grand ({{filesize}}MiB). Max autorisé: {{maxFilesize}}Mo.",e.options.dictInvalidFileType="Vous ne pouvez pas importer ce type de fichier.",e.options.dictResponseError="Erreur au niveau du serveur, code: {{statusCode}}.",e.options.dictCancelUpload="Annuler l'import",e.options.dictCancelUploadConfirmation="Etes-vous sûr?",e.options.dictRemoveFile="Retirer le fichier",e.options.dictMaxFilesExceeded="Vous avez atteint le nombre max d'importation.",$("#new_article").click((function(){e.processQueue()}))}))}function InitDropExcel(e,t){Dropzone.autoDiscover=!1;let a=new Dropzone("#"+e+"_form .dropzone",{url:t,paramName:"excel_file",maxFiles:1,timeout:0,addRemoveLinks:!0,acceptedFiles:"application/vnd.ms-excel, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",autoProcessQueue:!1,success:function(e,t){"success"===t.import?window.location.reload(!0):swal("Erreur lors de l'importation !!!","Veuillez à bien verifier les données du fichier s'il vous plait","error")}});a.options.dictDefaultMessage="Cliquez ou glisser votre fichier ici",a.options.dictFileTooBig="Fichier trop grand ({{filesize}}MiB). Max autorisé: {{maxFilesize}}Mo.",a.options.dictInvalidFileType="Vous ne pouvez pas importer ce type de fichier.",a.options.dictResponseError="Erreur au niveau du serveur, code: {{statusCode}}.",a.options.dictCancelUpload="Annuler l'import",a.options.dictCancelUploadConfirmation="Etes-vous sûr?",a.options.dictRemoveFile="Retirer le fichier",a.options.dictMaxFilesExceeded="Vous avez atteint le nombre max d'importation.",$(".btn_"+e).click((function(){a.processQueue()}))}function resetModal(e){$(e+" button.close").click((function(){$(e+"_content").html('<div style="width: 100%; height: 40vh" class="m-auto pt-5 text-center"><div class="spinner-border mb-4 text-dark" style="line-height: 100%" role="status"><span class="sr-only m-5">Chargement en cours, patientez un instant...</span></div></div>')}))}function load_modification(e,t){const a=$("button.modify_btn[data-identification="+t+"]");let l=a.attr("data-target")+"_content";$.get(e,(function(t){if($(""+l).html(""+t),$(".payement_select").select2({multiple:!0}),"#modal_modif_article"==a.attr("data-target")){let t="";resetModal(a.attr("data-target")),$(".update_image").click((function(a){a.preventDefault();let l=$(this);e=$("#updatePic").attr("data-link");let r=new Dropzone("#updatePic",{url:e,paramName:"pic",maxFilesize:4,maxFiles:1,addRemoveLinks:!0,acceptedFiles:"image/*",autoProcessQueue:!1});$("#update_article").click((function(){r.processQueue()}));let i=$("#updatePic img"),n=$(".cancel_image_update");t=i.attr("src"),l.addClass("hide"),$("#updatePic h6, #updatePic p").removeClass("hide"),n.removeClass("hide"),i.css("width","50%"),n.click((function(){l.removeClass("hide"),$("#updatePic h6, #updatePic p").addClass("hide"),n.addClass("hide"),i.attr("src",t),i.css("width","80%"),r.destroy()}))}))}}))}function load_showInfo(e,t){$.get(e,(function(e){$(t+"_content").html(e);let a=$('input[name="date_graph_filter"]');a.daterangepicker({autoUpdateInput:!1,locale:{cancelLabel:"Clear"}}),a.on("apply.daterangepicker",(function(e,t){$(this).val(t.startDate.format("MM/DD/YYYY")+" - "+t.endDate.format("MM/DD/YYYY"))})),$("input.create-event-datepicker").daterangepicker({singleDatePicker:!0,showDropdowns:!0,autoUpdateInput:!1}).on("apply.daterangepicker",(function(e,t){$(this).val(t.startDate.format("MM/DD/YYYY"))})),resetModal(t)}))}$("#reset_loc").click((function(){orderTable(table_loc,[[1,"desc"]])})),$("#reset_ext").click((function(){orderTable(table_ext,[[1,"desc"],[2,"asc"]])})),$("#filter_ext").click((function(){let e=[],t=$(this).parent().parent().serializeArray();t.forEach((function(a,l){l%2==0&&"false"!==a.value&&("1"===t[l+1].value?e.push([a.value,"desc"]):e.push([a.value,"asc"]))})),orderTable(table_ext,e)})),$("#filter_loc").click((function(){let e=[],t=$(this).parent().parent().serializeArray();t.forEach((function(a,l){l%2==0&&"false"!==a.value&&("1"===t[l+1].value?e.push([a.value,"desc"]):e.push([a.value,"asc"]))})),orderTable(table_loc,e)})),initEmptyDatePicker($("#min_ext, #max_ext, #min_loc, #max_loc")),$("#min_ext, #max_ext, #dateColonnePourLaFiltre_ext").on("apply.daterangepicker change",(function(){minDate=$("#min_ext"),maxDate=$("#max_ext"),dateColonnePourLaFiltre=$("#dateColonnePourLaFiltre_ext").val(),table_ext.draw()})),$("#min_loc, #max_loc, #dateColonnePourLaFiltre_loc").on("apply.daterangepicker change",(function(){minDate=$("#min_loc"),maxDate=$("#max_loc"),dateColonnePourLaFiltre=$("#dateColonnePourLaFiltre_loc").val(),table_loc.draw()})),table_ext.on("draw.dt",(function(){let e=table_ext.rows({search:"applied"}).data(),t=e.length,a=0,l=0,r=0;for(let i=0;i<t;i++){let t=e[i][2],n=parseInt(e[i][16].replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(",",".").replace(",",".")),o=parseInt(e[i][18].replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(",",".").replace(",","."));a+=t.indexOf("Ok")>0?0:1,l+=n,r+=o}$("#nb_searchResult_ext").html(t),$("#nbNot_searchResult_ext").html(a),$("#total_searchResult_ext").html(format_number(l)),$("#reste_searchResult_ext").html(format_number(r))})),table_loc.on("draw.dt",(function(){let e=table_loc.rows({search:"applied"}).data(),t=e.length,a=0,l=0,r=0;for(let i=0;i<t;i++){let t=e[i][2],n=parseInt(e[i][5].replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(",",".").replace(",",".")),o=parseInt(e[i][7].replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(",",".").replace(",","."));a+=t.indexOf("Ok")>0?0:1,l+=n,r+=o}$("#nb_searchResult_loc").html(t),$("#nbNot_searchResult_loc").html(a),$("#total_searchResult_loc").html(format_number(l)),$("#reste_searchResult_loc").html(format_number(r))})),$(document).ready((function(){$(".colomList :checkbox").each((function(){let e=$(this).attr("id");$(this).click((function(){!function(e){let t=$("#"+e),a=$("."+e);!1===t.prop("checked")?(t.addClass("hide"),a.each((function(){$(this).addClass("hide")}))):(t.removeClass("hide"),a.each((function(){$(this).removeClass("hide")})))}(e)}))}))})),$("#table_article_to_csv").click((function(){let e=new Date,t=$("#dateInfoAfficher").val();$("#list_article_"+t).table2excel({exclude:".hide, .pic ,.action",filename:"statArticleOn__"+t+"__("+e.getDate()+(parseInt(e.getMonth())+1)+e.getFullYear()+")",fileext:"xlsx",exclude_img:!1,exclude_links:!0,exclude_inputs:!0,preserveColors:!0})})),$("#table_achat_to_csv").click((function(){$("#list_achat").table2excel({exclude:".hide, .action",filename:"Liste Commande __"+(new Date).toISOString().replace(/[\-\:\.]/g,""),fileext:"xlsx",exclude_img:!0,exclude_links:!0,exclude_inputs:!0,preserveColors:!0})})),initDatePicker($('input[name="date_commande"], input[name="date_arrive"]')),initEmptyDatePicker($('input[name="date_livraison"], input[name="date_prev_arrive"], input[name="date_embarquement"],  input[name="date_achat"]')),loadConfirmDelete(),$(document).ready((function(){initSelect___(),$.fn.select2.defaults.set("theme","bootstrap-5")})),InitDropzone("add_btn_article"),$("#init_import_fournisseur").click((function(){InitDropExcel("import_fournisseur",$("#import_fournisseur_form").attr("action"))})),$("#init_import_article").click((function(){InitDropExcel("import_article",$("#import_article_form").attr("action"))})),$("#init_import_client").click((function(){InitDropExcel("import_client",$("#import_client_form").attr("action"))})),$("#modal_ajout_bc").on("hide.bs.modal",(function(){$("#date_commande").val("").removeClass("is-valid").removeClass("is-invalid"),$("#cours_in_use").val("").removeClass("is-valid").removeClass("is-invalid"),$("#ref_fact_frn").val("").removeClass("is-valid").removeClass("is-invalid"),$("#ref_fact_transit").val("").removeClass("is-valid").removeClass("is-invalid"),$("#date_embarquement").val("").removeClass("is-valid").removeClass("is-invalid"),$("#ref_fact_embarquement").val("").removeClass("is-valid").removeClass("is-invalid"),$("#frais").val("").removeClass("is-valid").removeClass("is-invalid"),$("#paye").val("").removeClass("is-valid").removeClass("is-invalid"),$("#list_cmd_externe").html(""),init_data(),update_total(),$("#fournisseur").val("").trigger("change").removeClass("is-valid").removeClass("is-invalid"),$("#transitaire").val("").trigger("change").removeClass("is-valid").removeClass("is-invalid")}));let mode="externe",tarif_usd=0,tarif_devise=0,tarif_ar=0,pat_frn=0,montant_total=0,vol_total_cmd=0,frais_transport=0,rest=0,cours_devise=0,cours_usd=0,tarif_avion=0,tarif_bateau=0;function init_data(){pat_frn=0,montant_total=0,vol_total_cmd=0,frais_transport=0,rest=0}function format_number(e){return Intl.NumberFormat("fr-FR").format(e)}function NIL(){$(".mode_achat").click((function(e){mode=$(this).attr("data-cmd"),"local"===mode?($(".notInLocale").addClass("hide"),$("#type_monaie").html("ariary")):($(".notInLocale").removeClass("hide"),$("#type_monaie").html("Devise"))}))}function update_cours(){$(".update_cours").click((function(){let e=$(this).attr("data-link"),t=$(this).attr("data-transit"),a=$("#cours_usd").val(),l=$("#cours_devise").val(),r=$("#tarif_bateau").val(),i=$("#tarif_avion").val();if(cours_usd=a,tarif_bateau=r,tarif_avion=i,void 0===t){t=$("#transitaire").val();let n={id_transitaire:t,id_devise:$("#cours_in_use").val(),cours_usd:a,cours_devise:l,tarif_bateau:r,tarif_avion:i};$.post(e,n,(function(e){$("#list_cmd_externe").html(""),init_data(),updateTarif(),update_total()}))}else{let e=$("#new_cours_usd").val();cours_usd=e,$("#cours_usd").val(cours_usd);let t=$("#tarif_aplique").val(),a=parseFloat($("span#vol_total_cmd").html().replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(",","."))*t,l=a*e,r=l+parseFloat($("#pat_frn_ar_cmd").html().replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(",",".")),i=r-parseFloat($("#acompte_payer").val());$(".new_rest").html(format_number(Math.round(i))),$(".montant_ar_cmd").html(format_number(Math.round(r))),$(".tarif_usd").html(t),$(".fret_cmd").html(format_number(a)),$(".fret_ar_cmd").html(format_number(Math.round(l))),$(".tarif_ar").html(format_number(Math.round(t*cours_usd))),$(".cours_usd").html(format_number(Math.round(e)))}$(this).parent().parent().parent().removeClass("show")}))}function updateTarif(){tarif_usd=$("#mode_avion").is(":checked")?tarif_avion:tarif_bateau,cours_usd=$("#cours_usd").val(),tarif_ar=tarif_usd*cours_usd,$(".tarif_usd").html(format_number(tarif_usd)),$(".tarif_ar").html(format_number(tarif_ar)),$(".cours_usd").html(format_number(cours_usd))}NIL(),$("#cours_in_use").on("change",(function(){let e=$(this).val(),t=$('#cours_in_use option[value="'+e+'"]').html(),a=$(this).attr("data-link"),l={id_cours:e};$.post(a,l,(function(e){$("#cours_devise").val(e.cours),$(".cours_devise").html(e.cours+" ar"),$(".devise_symbole").html(e.symbole),$(".nom_devise").html(t),cours_devise=e.cours,updateTarif(),$(".add_modal_trigger").removeAttr("disabled")})),$("#list_cmd_externe").html(""),init_data(),update_total()})),$("#frais").on("change keyup",(function(){let e=$(this).val();""===e&&(e=0),frais_transport=parseFloat(e),update_total()})),$("#transitaire").on("select2:select",(function(){$("#mode_avion").removeAttr("disabled"),$("#mode_bateau").removeAttr("disabled"),$(".update_cours_btn").removeAttr("disabled");let e=$(this).val(),t=$(this).attr("data-link"),a={id_transitaire:e};$.post(t,a,(function(e){$("#tarif_avion").val(e.tarif_avion),$("#tarif_bateau").val(e.tarif_bateau),tarif_avion=e.tarif_avion,tarif_bateau=e.tarif_bateau,updateTarif()})),$("#list_cmd_externe").html(""),init_data(),update_total()})),$('input[name="mode_transport"]').on("change",(function(){updateTarif(),$("#list_cmd_externe").html(""),init_data(),update_total()})),update_cours(),$("#fournisseur").on("select2:select",(function(){let e=$(this).val(),t=$(this).attr("data-link"),a={id_fournisseur:e};$.post(t,a,(function(e){$(".frn_specialisation").html(e.specialisation),$(".frn_correspondant").html(e.correspondant),$(".frn_mail").html(e.mail),$(".frn_messagerie").html(e.messagerie)}))}));var isAnUpdateOfArt=!1;function add_article_in_cmd(){let e,t=0,a=$("#form_article_designation");a.on("select2:select",(function(){if(!1===isAnUpdateOfArt){let l={id_article:a.select2("data")[0].id},r=a.attr("data-link");$.post(r,l,(function(a){$("#ref_article_fournisseur").val(a.ref),$("#qte_art").val(a.qte),$("#pa_art").val((a.pa/cours_devise).toFixed(3)),$("#vol_art").val(a.vol_ctn),$("#pcb").val(a.pcb),e=a.pr,t=a.pv}))}})),$("#add_article_in_cmd_list").on("hide.bs.modal",(function(){$("#ref_article_fournisseur").val(""),$("#qte_art").val(""),$("#pa_art").val(""),$("#vol_art").val(""),$("#pcb").val(""),a.val("").trigger("change")})),$("#add_article_cmd_btn").click((function(){let a=$("form.add_art_cmd_form_").serializeArray(),l=a[0],r=$("#form_article_designation option[value ="+l.value+"]").html(),i=a[1],n=a[2],o=a[3],c=a[4],s=a[5];if("externe"===mode)if(""===n.value||""===o.value||""===c.value||""===s.value||s.value<=0)swal("Oops...","Veuillez à bien verifier les données entrée S.V.P \n(champ vide, virgule à la place d'un point ...","error");else{$(".notInLocale").removeClass("hide");let a=$("#list_cmd_externe"),d=a.children().length,u=c.value/s.value,m=u*n.value,p=m/c.value,_=parseFloat(o.value),v=_*cours_devise,f=parseFloat(m)*parseFloat(tarif_usd)*cours_usd,h=parseFloat(_*n.value),b=parseFloat(v*n.value),g=b+parseFloat(f),y=g/n.value;pat_frn+=parseFloat(h),vol_total_cmd+=parseFloat(m),montant_total+=parseFloat(g),update_total(),$("#paye").on("change keyup",(function(){rest=montant_total-$(this).val()+frais_transport*cours_devise,update_total()})),a.append("<tr><td>"+r+"</td><td>"+n.value+"</td><td>"+s.value+"</td><td>"+format_number(u)+"</td><td>"+format_number(m)+"</td><td>"+format_number(c.value)+"</td><td>"+format_number(p)+"</td><td>"+format_number(_)+"</td><td>"+format_number(v)+"</td><td>"+format_number(Math.round(b))+"</td><td>"+format_number(Math.round(g))+"</td><td>"+format_number(Math.round(y))+"</td><td>"+format_number(Math.round(e))+"</td><td>"+format_number(Math.round(t))+'</td><td><input type="hidden" class="vol" value="'+m+'" ><input type="hidden" class="pat" value="'+h+'" ><input type="hidden" class="total" value="'+g+'" ><input type="hidden" class="pr_avant" value="'+e+'" ><input type="hidden" class="pv_avant" value="'+t+'" ><input type="hidden" class="id_article_entered" value="'+l.value+'" name="article['+d+'][id]"><input type="hidden" class="qte_entered" value="'+n.value+'" name="article['+d+'][qte]"><input type="hidden" class="pcb_entered" value="'+s.value+'" name="article['+d+'][pcb]"><input type="hidden" class="ref_entered" value="'+i.value+'" name="article['+d+'][ref_article_cmd]"><input type="hidden" class="vol_ctn_entered" value="'+c.value+'" name="article['+d+'][vol_ctn]"><input type="hidden" class="pa_entered" value="'+o.value+'" name="article['+d+'][pa_frn]"><button type="button" class="btn text-warning update_article_added" data-number="'+d+'" onclick="update_article_added('+d+')" data-toggle="modal" data-target="#modif_article_added"><i class="fas fa-pen"></i></button><button type="button" class="btn removeCmnd text-danger"><i class="ti-trash"></i></button></td></tr>'),$("#buttExtENR").html('<button type="submit" class="btn btn-success">Enregistrer</button>')}else if(""===n||""===o)swal("Oops...","Veuillez à bien verifier les données entrée S.V.P \n(champ vide, virgule à la place d'un point ...","error"),$("#buttonEnr").html("");else{let a=$("#list_cmd_interne"),i=a.children().length,c=n.value*o.value;a.append("               <tr>\n                    <td>"+r+"</td>\n                    <td>"+n.value+"</td>\n                    <td>"+o.value+"</td>\n                    <td>"+c+"</td>\n                    <td>"+e+"</td>\n                    <td>"+t+'</td>\n                    <td>                           <input type="hidden" class="id_article_entered" value="'+l.value+'" name="article['+i+'][id]">                           <input type="hidden" class="qte" value="'+n.value+'" name="article['+i+'][qte]">                           <input type="hidden" class="pa_unit" value="'+o.value+'" name="article['+i+'][pa_frn]">                           <input type="hidden" class="total" value="'+c+'" >                           <input type="hidden" class="pv_avant" value="'+t+'" >                           <input type="hidden" class="pr_avant" value="'+e+'" >                           <button type="button" class="btn text-warning update_article_added" data-number="'+i+'" data-toggle="modal" onclick="update_article_added('+i+')" data-target="#modif_article_added">                               <i class="fas fa-pen"></i>                           </button>                           <button type="button" class="btn removeCmnd text-danger">                               <i class="ti-trash"></i>                           </button>                   </td>\n</tr>'),pat_frn+=c,$("#total_interne").html(pat_frn),$("#add_article_in_cmd_list").modal("hide"),$("#buttonEnr").html('<button type="submit" class="btn btn-success">Enregistrer</button>')}return remove_article_added(),0}))}function remove_article_added(){$(".removeCmnd").click((function(){let e=$(this),t=e.siblings(".qte").val(),a=e.siblings(".pa_unit").val(),l=e.siblings(".pat").val(),r=e.siblings(".vol").val(),i=e.siblings(".total").val();swal({title:"Etes-vous sure?",text:"Cette action sera irreversible !",icon:"warning",buttons:!0,dangerMode:!0}).then((n=>{n&&("externe"===mode?(pat_frn-=l,vol_total_cmd-=r,montant_total-=i,update_total()):(i=a*t,pat_frn-=i,$("#total_interne").html(pat_frn)),e.parent().parent().remove(),swal({title:"C'est fait!",icon:"success"}))}))}))}function update_article_added(e){isAnUpdateOfArt=!0,btn___="externe"===mode?$("#list_cmd_externe button.update_article_added[data-number = "+e+"]"):$("#list_cmd_interne button.update_article_added[data-number = "+e+"]");let t=btn___.siblings(".id_article_entered").val();if($(".articleSelected_").select2().val(""+t).trigger("change.select2"),"externe"===mode){let e=btn___.siblings(".qte_entered").val(),t=btn___.siblings(".pcb_entered").val(),a=btn___.siblings(".ref_entered").val(),l=btn___.siblings(".vol_ctn_entered").val(),r=btn___.siblings(".pa_entered").val();$("#_updt_ref_article_fournisseur").val(a),$("#_updt_qte_art").val(e),$("#_updt_pa_art").val(r),$("#_updt_vol_art").val(l),$("#_updt_pcb").val(t)}else{let e=btn___.siblings(".pa_unit").val(),t=btn___.siblings(".qte").val();$("#updt_pa_art").val(e),$("#updt_qte_art").val(t)}}add_article_in_cmd(),$("#update_article_cmd_btn").click((function(){isAnUpdateOfArt=!1;let e=btn___,t=$("form.update_art_cmd_form_").serializeArray(),a=t[0],l=$("#updateTheArt option[value ="+a.value+"]").html(),r=e.attr("data-number"),i=t[1],n=t[2],o=t[3],c=t[4],s=t[5];if("externe"===mode){let t=parseFloat(e.siblings(".total").val().replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","")),d=parseFloat(e.siblings(".pr_avant").val().replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","")),u=parseFloat(e.siblings(".pv_avant").val().replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","")),m=parseFloat(e.siblings(".pat").val().replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","")),p=parseFloat(e.siblings(".vol").val().replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ",""));if(""===n.value||""===o.value||""===c.value||""===s.value||s.value<=0)swal("Oops...","Veuillez à bien verifier les données entrée S.V.P \n(champ vide, virgule à la place d'un point ...","error");else{pat_frn-=m,vol_total_cmd-=p,montant_total-=t,$(".notInLocale").removeClass("hide");let _=c.value/s.value,v=_*n.value,f=v/c.value,h=parseFloat(o.value),b=h*cours_devise,g=parseFloat(v)*parseFloat(tarif_usd)*cours_usd,y=parseFloat(h*n.value),x=parseFloat(b*n.value),C=x+parseFloat(g),k=C/n.value;pat_frn+=parseFloat(y),vol_total_cmd+=parseFloat(v),montant_total+=parseFloat(C),update_total(),e.parent().parent().html("<td>"+l+"</td><td>"+n.value+"</td><td>"+s.value+"</td><td>"+format_number(_)+"</td><td>"+format_number(v)+"</td><td>"+format_number(c.value)+"</td><td>"+format_number(f)+"</td><td>"+format_number(h)+"</td><td>"+format_number(b)+"</td><td>"+format_number(x)+"</td><td>"+format_number(C)+"</td><td>"+format_number(k)+"</td><td>"+format_number(d)+"</td><td>"+format_number(u)+'</td><td><input type="hidden" class="vol" value="'+v+'" ><input type="hidden" class="pat" value="'+y+'" ><input type="hidden" class="total" value="'+C+'" ><input type="hidden" class="pr_avant" value="'+d+'" ><input type="hidden" class="pv_avant" value="'+u+'" ><input type="hidden" class="id_article_entered" value="'+a.value+'" name="article['+r+'][id]"><input type="hidden" class="qte_entered" value="'+n.value+'" name="article['+r+'][qte]"><input type="hidden" class="pcb_entered" value="'+s.value+'" name="article['+r+'][pcb]"><input type="hidden" class="ref_entered" value="'+i.value+'" name="article['+r+'][ref_article_cmd]"><input type="hidden" class="vol_ctn_entered" value="'+c.value+'" name="article['+r+'][vol_ctn]"><input type="hidden" class="pa_entered" value="'+o.value+'" name="article['+r+'][pa_frn]"><button type="button" class="btn text-warning update_article_added" data-number="'+r+'" data-toggle="modal" onclick="update_article_added('+r+')" data-target="#modif_article_added"><i class="fas fa-pen"></i></button><button type="button" class="btn removeCmnd text-danger"><i class="ti-trash"></i></button></td>')}}else{let t=parseFloat(e.siblings(".total").val().replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","")),i=parseFloat(e.siblings(".pr_avant").val().replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","")),c=parseFloat(e.siblings(".pv_avant").val().replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ",""));if(""===n.value||""===o.value)swal("Oops...","Veuillez à bien verifier les données entrée S.V.P \n(champ vide, virgule à la place d'un point ...","error");else{pat_frn-=t;let s=o.value*n.value;pat_frn+=s,e.parent().parent().html("                    <td>"+l+"</td>\n                    <td>"+n.value+"</td>\n                    <td>"+format_number(o.value)+"</td>\n                    <td>"+format_number(s)+"</td>\n                    <td>"+format_number(i)+"</td>\n                    <td>"+format_number(c)+'</td>\n                    <td>                           <input type="hidden" class="id_article_entered" value="'+a.value+'" name="article['+r+'][id]">                           <input type="hidden" class="qte" value="'+n.value+'" name="article['+r+'][qte]">                           <input type="hidden" class="pa_unit" value="'+o.value+'" name="article['+r+'][pa_frn]">                           <input type="hidden" class="total" value="'+s+'" >                           <input type="hidden" class="pr_avant" value="'+i+'" >                           <input type="hidden" class="pv_avant" value="'+c+'" >                           <button type="button" class="btn text-warning update_article_added" data-number="'+r+'" data-toggle="modal" onclick="update_article_added('+r+')" data-target="#update_article_in_cmd_list">                               <i class="fas fa-pen"></i>                           </button>                           <button type="button" class="btn removeCmnd text-danger">                               <i class="ti-trash"></i>                           </button>                   </td>\n'),$("#total_interne").html(pat_frn)}}remove_article_added()}));let avance=0;function update_total(){let e=vol_total_cmd*tarif_usd,t=pat_frn*cours_devise,a=e*cours_usd;$("#cv_frais").html(format_number(Math.round(frais_transport*cours_devise))),$("#reste_paye_ar").html(format_number(Math.round(rest))),$("#pat_cmd_devise").html(format_number(pat_frn)),$("#pat_cmd_ar_val").html(format_number(Math.round(t))),$("#pat_frn_devise").html(format_number(pat_frn+frais_transport)),$("#pat_frn_ar_val").html(format_number(Math.round(t+frais_transport*cours_devise))),$("#vol_total").html(format_number(vol_total_cmd)),$("#fret_usd").html(format_number(e)),$("#fret_ar_val").html(format_number(Math.round(a))),$("#montant_ar").html(format_number(Math.round(montant_total+frais_transport*cours_devise)))}function closeTheModal(){$(".closeModal").click((function(){$(this).parent().parent().parent().parent().modal("hide")}))}function update_article_data(e){let t=$("#ar_"+e+" .art_des").html(),a=parseInt($("#ar_"+e+" .qte_cmd").html().replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ",".").replace(",",".")),l=parseInt($("#ar_"+e+" .pcb_cmd").html().replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ",".").replace(",","."));$("#designationDeArticleAModifier").html(t),$("#updt_qte_art").val(a),$("#updt_pcb").val(l),$("#butt_update_art_cmd").attr("data-index",e)}function update_count_afterUpdate(){let e=$("#butt_update_art_cmd").attr("data-index"),t=parseFloat($("#ar_"+e+" .volCtn_cmd").html().replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ",".").replace(",",".")),a=parseFloat($("#ar_"+e+" .pu_ar").html().replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ",".").replace(",",".")),l=parseFloat($("#ar_"+e+" .pu_dev").html().replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ",".").replace(",",".")),r=$("#updt_qte_art").val(),i=$("#updt_pcb").val(),n=t/i,o=n*r,c=o/t,s=a*r,d=r*l,u=$("#list_cmd_externe_suivi .vol_total_estime"),m=0,p=$("#list_cmd_externe_suivi .const_pat"),_=0,v=$("#list_cmd_externe_suivi .pat_dev"),f=0,h=parseFloat($("#tarif_aplique").val()),b=parseFloat($("#new_cours_usd").val()),g=$("#ar_"+e+" .art_des").attr("data-id");$("#ar_"+e+" .qte_cmd").html(format_number(r)),$("#ar_"+e+" .pcb_cmd").html(format_number(i)),$("#ar_"+e+" .volUnit_cmd").html(format_number(n)),$("#ar_"+e+" .nbCtn").html(format_number(c)),$("#ar_"+e+" .vol_total_estime").html(format_number(o)),$("#ar_"+e+" .pat_dev").html(format_number(d)),$("#ar_"+e+" .const_pat").html(format_number(Math.round(s))),$("#ar_"+e).find(".hidden_input").html('<input type="hidden" name="new_update['+e+'][article]" value="'+g+'"> <input type="hidden" name="new_update['+e+'][qte]" value="'+r+'"> <input type="hidden" name="new_update['+e+'][pcb]" value="'+i+'"> '),u.each((function(e,t){let a=parseFloat(t.innerHTML.replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ",".").replace(" ",".").replace(",","."));m+=a})),v.each((function(e,t){let a=parseFloat(t.innerHTML.replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ",".").replace(" ",".").replace(",","."));f+=a})),p.each((function(e,t){let a=parseFloat(t.innerHTML.replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ",".").replace(" ",".").replace(",","."));_+=a}));let y=m*h,x=y*b,C=x+_,k=C-parseInt($("#acompte_payer").attr("value"));$("#pat_frn_devise____").html(format_number(f)),$("#pat_frn_ar_cmd").html(format_number(Math.round(_))),$(".new_rest").html(format_number(Math.round(k))),$(".montant_ar_cmd").html(format_number(Math.round(C))),$("#vol_total_cmd").html(format_number(m)),$(".fret_cmd").html(format_number(y)),$(".fret_ar_cmd").html(format_number(Math.round(x)))}function suivi(e,t,a){let l="externe"===t?$(".suivi_bc .bcExt[data-id = "+a+"]"):$(".suivi_bc .bcLoc[data-id = "+a+"]"),r=l.children(".status_cmd"),i={type:t};$.post(e,i,(function(e){$("#modal_info_bc_content").html(e.info),null!==e.bc&&void 0!==e.bc&&($("#v_codeBc").html(e.bc.codeBc),$("#v_dateArrive").html(e.bc.dateArrive),$("#v_frn").html(e.bc.frn),$("#v_patFrn").html(format_number(Math.round(e.bc.patFrn))),$("#v_devise").html(e.bc.devise),$("#v_coursApplique").html(e.bc.coursApplique),$("#v_transitaire").html(e.bc.transitaire),$("#v_tarifApplique").html(e.bc.tarifApplique),$("#coursUsd").html(e.bc.coursUsd),e.bc.listArticle.forEach((function(e){$("#v_listArticle").append("<tr>\n                                    <td>"+e.article+"</td>\n                                    <td>"+e.qte_cmd+"</td>\n                                    <td>"+e.qte_recu+"</td>\n                                    <td>"+e.casse+"</td>\n                                    <td>"+format_number(e.vol_prevu)+"</td>\n                                    <td>"+format_number(e.vol_reel)+"</td>\n                                    <td>"+format_number(Math.round(e.pr_estime))+" ar</td>\n                                    <td>"+format_number(Math.round(e.new_pr))+" ar</td>\n                                    <td>"+format_number(Math.round(e.pr_actif))+" ar</td>\n                                    <td>"+format_number(Math.round(e.pv))+" ar</td>\n                                </tr>")}))),$("#modal_info_bc").on("hidden.bs.modal",(function(){$("#modal_info_bc_content").html('<div class="modal-header bg-dark">\n                <h6 class="modal-title">Patientez un instant</h6>\n                <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n                    <i class="ti-close"></i>\n                </button>\n            </div>\n\n            <div class="modal-body text-center" style="height: 40vh">\n                <div  class="spinner-border mt-5 text-info" role="status">\n                    <span class="sr-only mt-5 m-5">Chargement...</span>\n                </div>\n            </div>')})),$(".confirmBCDelete").click((function(e){e.preventDefault();let t=$(this).parent();swal({title:"Etes-vous sure?",text:"Cette action sera irreversible !",icon:"warning",buttons:!0,dangerMode:!0}).then((e=>{e&&t.submit()}))})),$("#butt_obs").click((function(e){e.preventDefault();let t=$(this).parent().parent().attr("action"),a=$(this).parent().parent().serialize();$.post(t,a,(function(e){$("#observationContainer").html(e),$("#_observationContainer").html(e),$("#modal_obs").modal("hide")}))})),$(".observation_btn").click((function(e){e.preventDefault();let t=$("#observation_btn").attr("data-link");$("#observation").parent().parent().attr("action",t),$("#observation").html($("#observationContainer").text())})),$(".validationAdmin").click((function(e){let t=$(this).attr("data-link");e.preventDefault(),$("#validationAdmin_form").attr("action",t),$("#_observationContainer").html($("#observationContainer").html())})),$("#deuxpaye, #acompte_payer").on("change keyup",(function(){let e=$("#deuxpaye").val();void 0===e&&(e=0);let t=$("#acompte_payer").val(),a=parseFloat($("#montant_ar span.montant_ar_cmd").html().replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(",","."));$(".rest_a_payer span.new_rest").html(format_number(Math.round(a-e-t)))})),update_cours(),$('input[name="date_embarquement"], input[name="date_arrive"] , input[name="date_achat"]').daterangepicker({singleDatePicker:!0,showDropdowns:!0,autoUpdateInput:!1}).on("apply.daterangepicker",(function(e,t){$(this).val(t.startDate.format("DD/MM/YYYY"))}));let t=$("#date_embarquement_s");t.on("apply.daterangepicker",(function(){if(""!==t.val()){let e=$(".printBC");e.removeClass("btn-dark"),e.addClass(" bg-info-bright text-info")}})),$(".printBC").click((function(e){""===$("#date_embarquement_s").val()||""===$("#ref_embarquement_s").val()?(e.preventDefault(),swal("Attention !","Veuillez verifier si les champs date et/ou ref d'embarquement ne sont pas vides","error")):$(this).parent().parent().submit()}));let a=null,i=null;$(".validation").click((function(){a=$(this),i=a.index();let e=parseFloat(a.find(".qte_recu").html().replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(",",".").replace(",",".")),t=parseFloat(a.find(".qte_nv").html().replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(",",".").replace(",",".")),l=parseFloat(a.find(".vol_reel").html().replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(",",".").replace(",",".")),r=parseFloat(a.find(".pcb_cmd").html().replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(",",".").replace(",",".")),n=parseFloat(a.find(".dp").html().replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(",",".").replace(",",".")),o=parseFloat(a.find(".nctn").html().replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(",",".").replace(",","."));$("#qte-reel").val(e),$("#qte-vendable").val(t),$("#vol-reel").val(l),$("#pcb-reel").val(r),$("#vdepot").val(n),$("#vnum_ctn").val(o)})),$("#butt-valider").click((function(e){e.preventDefault();let t=a.attr("data-id"),l=parseFloat(a.find(".qte_cmd").html().replace(" ","").replace(",",".").replace(",",".")),r=parseFloat(a.find(".nbCtn").html().replace(" ","").replace(" ","").replace(",",".").replace(",",".")),n=parseFloat(a.find(".vol_total_estime").html().replace(" ","").replace(",",".").replace(",",".")),o=parseFloat($("#tarif_aplique").val()),c=parseFloat($("#new_cours_usd").val()),s=$("#form_validation").serializeArray(),d=s[0].value,u=s[1].value,m=s[2].value,p=s[3].value,_=s[4].value,v=s[5].value,f=0,h=0,b=0,g=m*r,y=0,x=parseInt($("#pat_frn_ar_cmd").html().replace(" ","").replace(" ","").replace(" ","").replace(" ","")),C=parseInt($("#acompte_payer").attr("value")),k=$("#list_cmd_externe_suivi .vol_total_reel");a.find(".hidden_input").html('<input type="hidden" name="validation['+i+'][article]" value="'+t+'"> <input type="hidden" name="validation['+i+'][qte_reel]" value="'+d+'"> <input type="hidden" name="validation['+i+'][qte_nv]" value="'+u+'"> <input type="hidden" name="validation['+i+'][vol_reel]" value="'+m+'"> <input type="hidden" name="validation['+i+'][pcb_reel]" value="'+p+'"> <input type="hidden" name="validation['+i+'][num_ctn]" value="'+v+'"> <input type="hidden" name="validation['+i+'][depot]" value="'+_+'"> '),u>0?(a.addClass("bg-warning-bright"),a.removeClass("bg-danger-bright"),a.removeClass("bg-success-bright")):l>d?(a.addClass("bg-danger-bright"),a.removeClass("bg-warning-bright"),a.removeClass("bg-success-bright")):(a.addClass("bg-success-bright"),a.removeClass("bg-danger-bright"),a.removeClass("bg-warning-bright")),a.find(".qte_recu").html(format_number(d)),a.find(".qte_nv").html(format_number(u)),a.find(".qte_v").html(format_number(d-u)),a.find(".vol_reel").html(format_number(m)),a.find(".pcb_cmd").html(format_number(p)),a.find(".vol_total_reel").html(format_number(g)),k.each((function(e,t){let a=0;a=isNaN(parseFloat(t.innerHTML))?n:parseFloat(t.innerHTML.replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(",",".").replace(",",".")),y+=a})),f=y*o,b=x+f*c,h=b-C,$(".new_rest").html(format_number(Math.round(h))),$(".montant_ar_cmd").html(format_number(Math.round(b))),$(".tarif_usd").html(format_number(o)),$("#vol_total_cmd").html(format_number(y)),$(".fret_cmd").html(format_number(f)),$(".fret_ar_cmd").html(format_number(Math.round(f*c))),$(".tarif_ar").html(format_number(Math.round(o*c))),$(".cours_usd").html(format_number(c)),$("#modal_validation").modal("hide"),a=null})),$('input[name="date_embarquement"]').on("apply.daterangepicker",(function(){let e={date_embarquement:$(this).val()},t=$(this).attr("data-link");$.post(t,e,(function(e){$("#prev_date_arrive").val(e.prevision)}))})),$("#validation_local").click((function(e){e.preventDefault();let t=$(this).attr("href");$.get(t,(function(e){"ok"===e&&(l.find("td.status_cmd").html('<p class="p-3 bg-success-bright text-success border-radius-1">ok</p>'),$("#modal_info_bc").modal("hide"))}))})),closeTheModal(),$(".modify_avance").click((function(){let e=$(this).attr("data-link"),t=parseInt($("#aComptePayerAv").html().replace(" ","").replace(" ","").replace(" ","").replace(" ",""));$("#avance_").val(t),$("#butt-valider-avance").attr("data-link",e)})),$("#butt-valider-avance").click((function(e){e.preventDefault();let t=$("#form-valider_avance").serialize(),a=$(this).attr("data-link");$.post(a,t,(function(e){$("#modal_modif_avance").modal("hide"),$("#aComptePayerAv").html(format_number(e.avance)),l.find(".avance_paye_l").html(format_number(e.avance)),$("#restePayerRst").html(format_number(e.reste)),l.find(".reste_paye_l").html(format_number(e.reste)),e.reste<=0?($("#statusInterne").html('<p class="p-4 border-radius-1 shadow bg-success-bright text-center font-size-24 font-weight-800 text-success ">Payer</p>'),$("#modifAvance").html("<td></td>"),l.find(".statut_payement_l").html('<p class="p-2 font-size-11 bg-success border-radius-1">Payer</p>')):($("#statusInterne").html('<p class="p-4 border-radius-1 shadow bg-warning text-center font-size-24 font-weight-800 ">A payer</p>'),l.find(".statut_payement_l").html('<p class="p-2 font-size-11 bg-warning  border-radius-1">A payer</p>'))}))})),$("#validationBcInt").click((function(e){e.preventDefault();let t=$(this).attr("data-link"),a=$("#formValidBcInt").serialize();$.post(t,a,(function(e){"ok"===e&&($("#modal_info_bc_content").modal("hide"),r.html('<p class="p-2 font-size-12 bg-success border-radius-1">Ok</p>'),$("#statusInt").html('<p class="p-4 border-radius-1 shadow  bg-success text-center font-size-24 font-weight-800 ">OK</p>'))}))}))}))}function initDataTableWithFilter(e,t){return e.DataTable({colReorder:!0,drawCallback:function(){counter_dl<1&&loadConfirmDelete()},dom:"Qlfrtip",searchBuilder:{columns:t},language:{paginate:{first:"Premier",last:"Dernier",next:"Suivant",previous:"Précedent"},loadingRecords:"Chargement en cours...",search:"Mots clées",lengthMenu:"Nombre d' entré: _MENU_",info:"Nombre Total :<strong class='font-size-30'> _TOTAL_ <strong>",emptyTable:"Liste Vide",infoEmpty:"Rien à afficher",infoFiltered:" resultat",sZeroRecords:"Rien ne corespond à vos conditions (ou recherche)",searchBuilder:{add:"+",condition:"Condition",clearAll:"Enlevé tous les filtre",delete:'<i class="fa fa-trash"></i>',deleteTitle:"Enlevé ce filtre",data:"Colonne",left:"<",leftTitle:"Exclusion",logicAnd:"et",logicOr:"ou",right:">",rightTitle:"Inclusion",title:{0:'<h6 class="underline ">Filtre des données : </h6>',_:'Nombre de filtre: <b class="underline">%d</b>'},value:"Valeur",valueJoiner:"et",conditions:{string:{contains:"Contenant",empty:"Vide",endsWith:"Se termine par",equals:"Egale à ",not:"Different de",notContains:"Ne contenant pas",notEmpty:"Pas vide",notEndsWith:"Ne se termine pas par",notStartsWith:"Ne commançant pas",startsWith:"Commançant par"}}}}}).order([[0,"desc"]]).draw()}$("#avance").on("change keyup",(function(){avance=$(this).val(),reste=pat_frn-avance,$("#reste").html(reste)})),closeTheModal(),initDataTableWithFilter($("#list_fournisseur, #list_client"),[1,2,3,4,5,6,7,8,9,10]);let tableArticle=initDataTableWithFilter($("#list_article"),[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]),tableDevis=initDataTableWithFilter($("#list_devis"),[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]),tableCommande=initDataTableWithFilter($("#list_commande"),[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]),tableFacture=initDataTableWithFilter($("#list_facture"),[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]);function getImagePreview(e){var t=URL.createObjectURL(e.target.files[0]),a=document.getElementById("preview"),l=document.createElement("img");a.innerHTML="",l.src=t,l.width="100%",a.appendChild(l)}$(".modifUser").click((function(){let e=$(this).attr("data-url"),t={id:$(this).attr("dataCallId")};$.post(e,t,(function(e){$(".userPseudo").val(e.pseudo),$(".userNom").val(e.nom),$(".userPrenom").val(e.prenom),$(".userPoste").val(e.poste),$(".validationModifUser").attr("action","/user/modif/valid/"+e.id),"ROLE_ADMIN"==e.roles[0]?($(".Role1").replaceWith('<option value="1" class="Role1">ADMIN</option>'),$(".Role2").replaceWith('<option value="2" class="Role2">USER</option>')):"ROLE_USER"==e.roles[0]?($(".Role1").replaceWith('<option value="2" class="Role1">USER</option>'),$(".Role2").replaceWith('<option value="1" class="Role2">ADMIN</option>')):"ROLE_SUPER_ADMIN"==e.roles[0]&&($(".Role1").replaceWith('<option value="3"  class="Role1">SUPER ADMIN</option>'),$(".Role2").replaceWith('<option  class="Role2"></option>'))}))})),$(".btnModifProfile1").click((function(e){e.preventDefault(),$(".cardModifProdile").fadeIn()})),$(".closeModifProfile").click((function(){$(".cardModifProdile").fadeOut()})),$(".custom-file-input").on("change",(function(e){var t=e.currentTarget;$(t).parent().find(".custom-file-label").html(t.files[0].name)})),$(".abc").click((function(e){e.preventDefault()}));let listOfArticle=null,listOfArticleCyrus=null,listOfClient=null,listOfAction=null,listOfPrice=[],indexOfArticle=0,typedInSelect="",inOCR=null,pLink=null,lLink=null,_rfa=0,_rExp=0,_tva=0;function printDevis(e){$(".fdev_date_dmd").html($("#"+e+" #date_dmd").val()),$(".fdev_date_exp").html($("#"+e+" #date_exp").val()),$(".fdev_contact_cli").html($("#"+e+" #contact_client").val()),$(".fdev_cli").html($("#"+e+" #select2-selectClient_-container").html()),$(".fdev_totalCmd").html($("#"+e+" #total_of_article_added").html()),$(".fdev_frais").html($("#"+e+" #_frais_de_livraison").val()),$(".fdev_rfa").html($("#"+e+" #_rfa").val()),$(".fdev_remAcc").html(format_number($("#"+e+" #_remiseGlobal").val())),$(".fdev_remExp").html(format_number($("#"+e+" #_remiseExp").val())),$(".observationDev").html($("#"+e+" #devis_observation").val());let t=parseInt($("#"+e+" #totalAPayer").html().replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(",",".").replace(",","."));$(".fdev_totalnet").html(format_number(t)),$("#tot_ltr_dev").html(NumberToLetter(t));let a=$("#"+e+" #delai_p :checked").val()>=0?$("#"+e+" #delai_p input:checked").val():$("#"+e+" #autre_delai_payement").val();$(".fdev_delaiP").html(0===a?"Jour-J":a+" jours");let l=$("#"+e+" #article_in_devis_cmd tr").length;for(let t=0;t<l;t++){let a=(""+$("#"+e+" #produit_"+t+' option[value="'+$("#"+e+" #produit_"+t).val()+'"]').html().split("]")[1]).trim(),l=$("#"+e+" #pu_"+t).val(),r=$("#"+e+" #qte_"+t).val(),i=l*r;$("#fdevListArt").append('<tr>                   <td class="border border-dark">'+r+'</td>\n                   <td class="border border-dark">'+a+'</td>\n                   <td class="border border-dark">'+l+'</td>\n                   <td class="border border-dark">'+format_number(i)+"</td></tr>")}printJS({printable:"print_fact_devis",type:"html",scanStyles:!1,css:[""+$("#1__").attr("data-link"),""+$("#2__").attr("data-link"),""+$("#3__").attr("data-link"),""+$("#4__").attr("data-link")]})}function commandeThis(e,t){$("#devisStatut_").val(1);let a=$("#"+e),l=a.serialize();$.post(t,l,(function(e){"success"===e.statut?(swal("Devis commandé","Aller voir dans la page commande pour la facturation","success"),window.open(t,"_blank"),a.submit()):swal("Une erreur s'est produit","Contacter votre technicien s'il vous plait","error")}))}function addCommandeEntry(e,t,a=!1,l=null){0===indexOfArticle&&(indexOfArticle=e.children().length);let r=indexOfArticle;if(indexOfArticle++,!1===a){let a="modification_cmd_form"===t?'<td class="form-group"><input type="number" class="form-control qte_fact text-center" style="width: 80px" id="qte_fact_'+r+'" value="0" name="article['+r+'][qte_fact]" placeholder="Qte"></td>':"",l="modification_cmd_form"!==t?'<td class="form-group"><span id="__stockth_'+r+'"></span></td><td class="form-group"><span id="__stockreel_'+r+'"></span></td>':"";e.append('<tr class="article" data-number="'+r+'"><td class="form-group"><select type="text" class="form-control produit" style="text-overflow:ellipsis;" id="produit_'+r+'"><option>Choisir un article...</option></select><input type="hidden" id="__produit_'+r+'" name="article['+r+'][article]"></td><td class="form-group"><textarea class="form-control" style="text-overflow:ellipsis;min-height: 35px; width: 150px" id="description_'+r+'" name="article['+r+'][description]" placeholder="Description"></textarea></td><td class="form-group"><input type="number" class="form-control text-center" disabled value="0" style="width: 100px" id="pu_'+r+'" name="article['+r+'][pu]" placeholder="P.U"><input type="hidden" id="__pu_'+r+'" name="article['+r+'][pu]"></td>'+l+'<td class="form-group"><input type="number" class="form-control text-center" min="0" style="width: 80px" id="qte_'+r+'" value="1" name="article['+r+'][qte]" placeholder="Qte"><input type="hidden" class="form-control text-center" id="cmd_qte_fact_'+r+'" value="0" name="article['+r+'][qte_fact]"><input type="hidden" class="form-control text-center" id="cmd_qte_ech_'+r+'" value="0" name="article['+r+'][qte_ech]"></td>'+a+'<td class="form-group"><select type="text" class="form-control action" id="action_'+r+'" name="article['+r+'][action]">                       <option value="0"> - </option>\n</td><td><input type="number" class="form-control text-center" style="width: 70px" id="remise_'+r+'" value="0" name="article['+r+'][remise]" placeholder="%"></td><td class="form-group"><span class="sous-total" id="sousTotal_'+r+'">0</span> Ar</td><td class="form-group"><div class="btn btn-outline-danger btn-sm remove_article_in_this" style="cursor: pointer;"><i class="ti-trash"></i></div></td></tr>'),initSelect___(),$("#"+t+" #produit_"+r).select2({data:listOfArticle,language:{noResults:function(){return"<div class='text-center'><span class='text-muted font-size-13'>Ooooo!!, pas de resultat! <i class='fas fa-smile'></i></span><br><a href='"+$("#article_url").attr("href")+"' target=\"_blank\" class='btn create_this_article btn-sm btn-success'>Page article ?</a></div>"}},escapeMarkup:function(e){return e}})}else e.append('<tr class="article" data-number="'+r+'"><td class="form-group"><select type="text" class="form-control" style="text-overflow:ellipsis;" id="produit_'+r+'" name="article['+r+'][article]"><option value="'+a.id+'">['+a.cyrus+"]"+a.designation+'</option></select></td><td class="form-group"><textarea class="form-control" style="text-overflow:ellipsis;min-height: 35px; width: 150px" id="description_'+r+'" name="article['+r+'][description]" placeholder="Description"></textarea></td><td class="form-group"><input type="number" disabled class="form-control '+(parseFloat(l[6])>a.psb2b?"bg-danger":"bg-success")+' text-center" style="width: 100px" id="pu_'+r+'" name="article['+r+'][pu]" value="'+parseFloat(l[6])+'"><input type="hidden" id="__pu_'+r+'"  value="'+parseFloat(l[6])+'" name="article['+r+'][pu]"></td><td class="form-group"><span id="__stockth_'+r+'">'+a.stockTheorique+'</span></td><td class="form-group"><span id="__stockreel_'+r+'">'+a.stockReel+'</span></td><td class="form-group"><input type="number" class="form-control text-center" min="0" max="'+a.stockReel+'" style="width: 80px" id="qte_'+r+'" name="article['+r+'][qte]"  value="'+parseFloat(l[5])+'"><input type="hidden" class="form-control text-center" id="cmd_qte_fact_'+r+'" value="0" name="article['+r+'][qte_fact]"><input type="hidden" class="form-control text-center" id="cmd_qte_ech_'+r+'" value="0" name="article['+r+'][qte_ech]"></td><td class="form-group"><select type="text" class="form-control" disabled id="action_'+r+'" name="article['+r+'][action]">                       <option value="0" > Pas de thème pour S.B2B </option>\n</td><td><input type="number" class="form-control text-center" style="width: 70px" id="remise_'+r+'" value="0" name="article['+r+'][remise]" ></td><td class="form-group"><span class="sous-total" id="sousTotal_'+r+'">'+format_number(parseFloat(l[6])*parseFloat(l[5]))+'</span> Ar</td><td class="form-group"><div class="btn btn-outline-danger btn-sm remove_article_in_this" style="cursor: pointer;"><i class="ti-trash"></i></div></td></tr>'),updateInCmd(t);$("#"+t+" .produit").on("select2:select",(function(){let e=$(this).parent().parent().attr("data-number"),a=$("#"+t+" #article_in_devis_cmd").attr("data-ILink"),l=$("#"+t+" #produit_"+e).select2("data")[0].id;$("#"+t+" #__produit_"+e).val(l),$.post(a,{idOfArticle:l},(function(a){listOfPrice[""+e]=a.listOfPrice;let l=$("#"+t+" #pu_"+e),r=$("#"+t+" #__pu_"+e),i=$("#"+t+" #sousTotal_"+e);switch($("#"+t+" #cat_client").val()){case"1":l.val(a.pb2c),r.val(a.pb2c),i.html(format_number(a.pb2c));break;case"2":l.val(a.pb2b),r.val(a.pb2b),i.html(format_number(a.pb2b));break;case"3":l.val(a.psb2b),r.val(a.psb2b),i.html(format_number(a.psb2b));break}$("#"+t+" #__stockth_"+e).html(a.stockTheorique),$("#"+t+" #__stockreel_"+e).html(a.stockReel),$("#"+t+" #action_"+e).select2({data:a.listOfAction,language:{noResults:function(){return"<div class='text-center'><span class='text-muted font-size-13'>Ooooo!!, pas de resultat! <i class='fas fa-smile'></i></span></div>"}},escapeMarkup:function(e){return e}}),r.val($("#pu_"+e).val()),$("#"+t+" #produit_"+e).prop("disabled","true"),updateInCmd(t)}))})),$("#"+t+" .action").on("select2:select",(function(){let e=$(this).parent().parent().attr("data-number"),a=$("#action_"+e).select2("data")[0].id;switch($("#modal_commande_ajout #cat_client").val()){case"1":$("#"+t+" #pu_"+e).val(listOfPrice[e][a].pb2c);break;case"2":$("#"+t+" #pu_"+e).val(listOfPrice[e][a].pb2b);break}$("#"+t+" #__pu_"+e).val($("#pu_"+e).val()),updateSousTotal(t,e)})),updateIfChangement(t),removeArticleAdded(t)}function updateIfChangement(e){$("#"+e+" .article").on("change keyup",(function(){let t=$(this).attr("data-number");updateSousTotal(e,t)})),$("#"+e+" #totalOfOneCmd, #"+e+" #cat_client, #"+e+" #selectClient_, #"+e+" #article_in_devis_cmd").on("change keyup select2:select",(function(){updateInCmd(e)}))}function removeArticleAdded(e){$(".remove_article_in_this").click((function(t){t.preventDefault(),$(this).parent().parent().remove(),updateInCmd(e)}))}function updateSousTotal(e,t){let a=$("#"+e+" #pu_"+t).val(),l=$("#"+e+" #qte_fact_"+t),r=$("#"+e+" #qte_"+t);l.attr("max",r.val());let i="modification_cmd_form"===e&&l.val()>0?l.val():r.val(),n=$("#"+e+" #remise_"+t).val(),o=Math.round(a*i-a*i*(n/100));$("#"+e+" #sousTotal_"+t).html(format_number(o))}function updateInCmd(e){let t=$("#"+e+" #article_in_devis_cmd tr .sous-total"),a=0;t.each((function(e,t){let l=0;isNaN(parseFloat(t.innerHTML))||(l=parseFloat(t.innerHTML.replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(",",".").replace(",","."))),a+=l})),$("#"+e+" #total_of_article_added").html(format_number(a));let l=$("#"+e+" #_frais_de_livraison").val(),r=$("#"+e+" #_remiseGlobal").val(),i=$("#"+e+" #_acompte").val(),n=Math.round(a*_rfa/100),o=Math.round(a*_tva/100),c=Math.round(a*_rExp/100);if("new_devis_form"===e||"modif_devis_form"===e){let t=$("#"+e+" #rexp_pc").val(),l=$("#"+e+" #rfa_pc").val();n=Math.round(a*l/100),o=0,c=Math.round(a*t/100)}let s=a+parseFloat(l)-parseFloat(r)-n-c+o,d=s-parseFloat(i);$("#tot_ltr_b2b").html(NumberToLetter(s)),$("#"+e+" #totalAPayer").html(format_number(s)),$("#"+e+" #_reste").html(format_number(d)),$("#"+e+" #_rfa").val(n),$("#"+e+" #_remiseExp").val(c)}function manisyEnreeAnatyModification(){let e="modification_cmd_form";addCommandeEntry($("#"+e+" #article_in_devis_cmd"),e)}function modificationCommande(e){$.get(e,(function(e){let t="modification_cmd_form";$("#"+t+" #refBCClient").val(e.refBCClient),$(".fb2brefBCClient").html(e.refBCClient),$("#modif_ref_bcv").html(e.ref),$("#modif_ref_facturedeceBcV").html(e.refFact),$("#id_modif").val(e.id),$("#modif_user").html(e.user),$("#modif_date_creation_bcv").html(e.date_cmd),$("#modif_client").html('<option value="">'+e.client.designation+"</option>"),$(".bl_cli").html(e.client.designation),$(".fb2b_cli").html(e.client.designation),$(".fb2c_cli").html(e.client.designation),$("#fact_cli").html("["+e.client.code_cli+"] "+e.client.designation),$(".fb2c_cli2").html(e.client.designation),$(".fb2c_code_cli").html(e.client.code_cli),$(".code_cli").html(e.client.code_cli),$("#"+t+" #cmd_code_cli").val(e.client.code_cli),$("#modif_statut").html("Commandé"===e.statut?'<span class="rounded p-1 bg-info-bright text-info">'+e.statut+"</span>":'<span class="rounded p-1 bg-success-bright text-success">'+e.statut+"</span>"),$("#"+t+" #cat_client").val(e.client.cat),_rfa=e.client.rfa,_rExp=e.client.rexp,_tva=e.client.tva,initEmptyDatePicker($("#fact_date_livraison_commande, #"+t+" #date_livraison_commande")),$("#fact_heure_livraison_commande, #"+t+" #heure_livraison_commande").clockpicker({autoclose:!0}),$("#"+t+" #date_livraison_commande").val(e.date_livr),$("#"+t+" #heure_livraison_commande").val(e.heure_livr),politique_selection=$("#"+t+" select.politique"),politique_selection.select2({data:e.client.listPol?e.client.listPol:[],multiple:!1,language:{noResults:function(){return pl=pLink,typedInSelect=event.target.value,"<div class='text-center'><span class='text-muted font-size-13'>Ooooo!!, pas de resultat! <i class='fas fa-smile'></i></span><br><button type='button' onclick='createThisQuickly(politique_selection, pl)' class='btn create_this_article btn-sm btn-success'>Nouvelle politique ?</button></div>"}},escapeMarkup:function(e){return e}}),e.client.politique>0&&politique_selection.val(e.client.politique).trigger("change"),adress_selection=$("#"+t+" select.lieu_livraison"),adress_selection.select2({data:e.client.listAdress,multiple:!1,language:{noResults:function(){return ll=$("#new_cmd_form select.selectClient").attr("data-LLink"),typedInSelect=event.target.value,"<div class='text-center'><span class='text-muted font-size-13'>Ooooo!!, pas de resultat! <i class='fas fa-smile'></i></span><br><button type='button' onclick='createThisQuickly(adress_selection, ll)' class='btn create_this_article btn-sm btn-success'>Nouvelle adresse ?</button></div>"}},escapeMarkup:function(e){return e}}),adress_selection.val(e.lieu_livr).trigger("change"),$("#"+t+" #contact_client").val(e.client.contact),$("#"+t+" .add_article_in_modif_cmd").removeClass("hide"),$("#"+t+" .spin_add_article_in_modif_cmd").addClass("hide");let a=$("#"+t+" #commande_tags");a.val(e.tag),a.tagsinput("items"),$("#"+t+" #mode_payement").select2({data:e.client.listModeP,multiple:!1}).val(e.client.mp).trigger("change"),"interne"===e.livreur?$("#"+t+" #livreur1").prop("checked"):$("#"+t+" #livreur2").prop("checked"),0!==e.client.delai&&7!==e.client.delai&&15!==e.client.delai&&30!==e.client.delai&&60!==e.client.delai?($("#"+t+' #delai_p  input[value="-1"]').prop("checked",!0),$("#"+t+" #delai_p #input_other_delai").removeClass("hide"),$("#"+t+" #delai_p #autre_delai_payement").val(e.client.delai)):($("#"+t+" #delai_p #input_other_delai").addClass("hide"),$("#"+t+' #delai_p input[value="'+e.client.delai+'"]').prop("checked",!0));let l=$("#"+t+" #article_in_devis_cmd");l.html(""),e.liste_article.forEach((function(e,a){listOfPrice[""+a]=e.list_prix_action,l.append('<tr class="article" data-number="'+a+'"><td class="form-group"><select type="text" class="form-control produit" style="text-overflow:ellipsis; min-width: 160px" disabled id="produit_'+a+'"><option value="'+e.article_id+'">[+]'+e.designation+'</option></select><input type="hidden" value="'+e.article_id+'"  name="article['+a+'][article]"></td><td class="form-group"><textarea class="form-control" style="text-overflow:ellipsis;min-height: 35px; width: 150px" id="description_'+a+'" name="article['+a+'][description]" placeholder="Description">'+e.description+'</textarea></td><td class="form-group"><input type="number" class="form-control text-center" disabled value="'+e.pu+'" style="width: 100px" id="pu_'+a+'" name="article['+a+'][pu]" placeholder="P.U"><input type="hidden" value="'+e.pu+'" id="__pu_'+a+'" name="article['+a+'][pu]"></td><td class="form-group"><input type="number" class="form-control text-center" style="width: 80px" id="qte_'+a+'" value="'+e.qte_cmd+'" name="article['+a+'][qte]" placeholder="Qte"><input type="hidden" class="form-control text-center" id="cmd_qte_fact_'+a+'" value="'+e.qte_fact+'" name="article['+a+'][qte_fact]"><input type="hidden" class="form-control text-center" id="cmd_qte_ech_'+a+'" value="'+e.qte_ech+'" name="article['+a+'][qte_ech]"></td><td class="form-group"><input type="number" min="0" max="'+e.qte_cmd+'"  class="form-control qte_fact text-center" style="width: 80px" id="qte_fact_'+a+'" value="'+e.qte_fact+'" placeholder="Qte"></td><td class="form-group"><select type="text" class="form-control action" id="action_'+a+'" name="article['+a+'][action]">                       <option value="0"> - </option>\n</td><td><input type="number" class="form-control text-center" style="width: 70px" id="remise_'+a+'" value="'+e.remise+'" name="article['+a+'][remise]" placeholder="%"></td><td class="form-group"><span class="sous-total" id="sousTotal_'+a+'">'+e.sous_total+'</span> Ar</td><td class="form-group"><div class="btn btn-outline-danger btn-sm remove_article_in_this" style="cursor: pointer;"><i class="ti-trash"></i></div></td></tr>'),action_selection=$("#"+t+" #action_"+a),action_selection.select2({data:e.list_action,multiple:!1,language:{noResults:function(){return"<div class='text-center'><span class='text-muted font-size-13'>Ooooo!!, pas de resultat! <i class='fas fa-smile'></i></span></div>"}},escapeMarkup:function(e){return e}}),action_selection.val(e.action).trigger("change"),$("#"+t+" .action").on("select2:select",(function(){let e=$(this).parent().parent().attr("data-number"),a=$("#action_"+e).select2("data")[0].id;switch($("#modal_commande_ajout #cat_client").val()){case"1":$("#"+t+" #pu_"+e).val(listOfPrice[e][a].pb2c);break;case"2":$("#"+t+" #pu_"+e).val(listOfPrice[e][a].pb2b);break}$("#"+t+" #__pu_"+e).val($("#pu_"+e).val()),updateSousTotal(t,e)})),updateSousTotal(t,a),updateIfChangement(t),removeArticleAdded(t)})),$("#"+t+" .qte_fact").on("change keyup",(function(){let e=$(this).val(),t=$(this).parent().parent().attr("data-number");$("#cmd_qte_fact_"+t).val(e)})),listOfArticle=e.allArticle,listOfArticleCyrus=e.list_cyrus;let r=new Date,i=e.ref,n="INV"+(""+r.getFullYear()).substr(2)+(""+(r.getMonth()+1)).padStart(2,"0")+(""+(e.lastFact+1)).padStart(4,"0");$("span#newBCV").html(i),$("span#newFact").html(n),$(".refFact").html(n),$(".b2c_ref_fact").html(n),$(".b2c_ref_fact2").html(n),$(".refBcv").html(i),$(".b2c_refBcv").html(i),$("#"+t+" #_frais_de_livraison").val(e.frais_livr),$("#"+t+" #_remiseExp").val(e.rexp),$("#"+t+" #_rfa").val(e.rfa),$("#"+t+" #_remiseGlobal").val(e.remise),$("#"+t+" #totalAPayer").val(e.total),$("#"+t+" #_acompte").val(e.acompte),$("#"+t+" #_reste").val(e.reste),$("#"+t+" #commande_observation").val(e.observation),updateInCmd(t)})),$("#modal_commande_modify").on("hidden.bs.modal",(function(){let e=$("#new_cmd_form #article_in_devis_cmd"),t=e.attr("data-ILink"),a=e.attr("data-link");$("span#modif_ref_bcv").html("............."),$("span#modif_statut").html("..........."),$("span#modif_date_creation_bcv").html("..........."),$("span#modif_user").html("..........."),$("form#modification_cmd_form").html('<input type="hidden" id="id_modif" name="id_modif">\n        <div class="row">\n            <div class="col-8 border border-dark rounded p-4 mb-3">\n                <div class="row">\n                    <div class="col-6">\n                        <div class="form-group">\n                            <label for="modif_client">Client : </label>\n                            <select disabled class=" mt-2 custom-select form-control" id="modif_client">\n                                <option value=""></option></select>\n                        </div>\n                        <input type="hidden" name="code_client" id="cmd_code_cli">\n                    </div>\n                    <div class="col-3">\n                        <div class="form-group">\n                            <label for="cat_client">Tarification : </label>\n                            <select type="text" disabled class="form-control" id="cat_client" name="cat_client">\n                                <option value="1">B2C</option>\n                                <option value="2">B2B</option>\n                                <option value="3">SB2B</option>\n                            </select>\n                        </div>\n                    </div>\n                    <div class="col-3">\n                        <div class="form-group">\n                            <label for="contact_client">Contact : <i class="fas fa-phone"></i> || <i class="fas fa-envelope"></i> </label>\n                            <input type="text" id="contact_client" name="contact_client" class="form-control">\n                        </div>\n                    </div>\n                    <div class="col-12">\n                       <div class="row">\n                           <div class="col-9">\n                               <div class="form-group">\n                                   <label for="politique"><i class="fas fa-file-invoice"></i>  Politique de payement: </label>\n                                   <select id="politique" name="politique" class="form-control politique custom-select">\n                                       <option value="-1">-</option>\n                                   </select>\n                               </div>\n                           </div>\n                           <div class="col-3">\n                               <div class="form-group">\n                                   <label for="mode_payement"><i class="fas fa-file-invoice"></i>  Mode de payement: </label>\n                                   <select id="mode_payement" name="mode_payement" class="form-control mode_payement custom-select">\n                                        <option value="1">Espèce</option>\n                                    </select>\n                               </div>\n                           </div>\n                       </div>                    </div>\n                </div>\n\n\n                <div class="row" id="delai_p">\n                    <p class="underline col-12">Delai de payement : </p>\n                    <div class="col">\n                        <div class="custom-control custom-radio">\n                            <input type="radio" id="customRadio" value="0" name="delai_payement_client" class="custom-control-input" checked>\n                            <label class="custom-control-label" for="customRadio">Jours-J</label>\n                        </div>\n                    </div>\n                    <div class="col">\n                        <div class="custom-control custom-radio custom-checkbox-secondary">\n                            <input type="radio" id="customRadio1" value="7" name="delai_payement_client" class="custom-control-input">\n                            <label class="custom-control-label" for="customRadio1">7 jours</label>\n                        </div>\n                    </div>\n                    <div class="col">\n                        <div class="custom-control custom-radio custom-checkbox-success">\n                            <input type="radio" id="customRadio2" value="15" name="delai_payement_client" class="custom-control-input">\n                            <label class="custom-control-label" for="customRadio2">15 jours</label>\n                        </div>\n                    </div>\n                    <div class="col">\n                        <div class="custom-control custom-radio custom-checkbox-danger">\n                            <input type="radio" id="customRadio3" value="30" name="delai_payement_client" class="custom-control-input">\n                            <label class="custom-control-label" for="customRadio3">30 jours</label>\n                        </div>\n                    </div>\n                    <div class="col">\n                        <div class="custom-control custom-radio custom-checkbox-warning">\n                            <input type="radio" id="customRadio4" value="60" name="delai_payement_client" class="custom-control-input">\n                            <label class="custom-control-label" for="customRadio4">60 jours</label>\n                        </div>\n                    </div>\n                    <div class="col">\n                        <div class="custom-control custom-radio custom-checkbox-dark">\n                            <input type="radio" id="autreDelaiDeP" value="-1" name="delai_payement_client" class="custom-control-input">\n                            <label class="custom-control-label" for="autreDelaiDeP">autre</label>\n                        </div>\n                    </div>\n                    <div class="col-12 mt-3 text-center hide" id="input_other_delai">\n                        <input id="autre_delai_payement" type="text" name="autre_delai_payement" placeholder="Autres parmis ces choix...    ( en jours )" class="form-control">\n                        <label for="autre_delai_payement"></label>\n                    </div>\n                </div>\n\n            </div>\n            <div class="col-4 p-4 ">\n\n                <div class="row">\n                    <div class="col-lg-6">\n                        <div class="form-group text-center">\n                            <span class="underline"><i class="fas fa-calendar-day pr-2"></i>Date de livraison:</span>\n                            <label for="date_livraison_commande"><input id="date_livraison_commande" autocomplete="off" type="text" required name="date_livraison_commande" placeholder="Cliquez ici!" class="form-control"></label>\n                        </div>\n                    </div>\n                    <div class="col-lg-6">\n                        <div class="form-group text-center">\n                            <span class="underline"><i class="fas fa-clock pr-2"></i>Heure:</span>\n                            <label for="heure_livraison_commande"><input placeholder="Cliquez ici!" id="heure_livraison_commande" autocomplete="off" type="text" name="heure_livraison_commande" class="form-control"></label>\n                        </div>\n                    </div>\n                    <div class="col-lg-12">\n                        <label for="lieu_livraison"><span class="underline"><i class="fas fa-map-location pr-2"></i>Lieu de livraison :</span></label>\n                        <select id="lieu_livraison" name="lieu_livraison" required class="form-control lieu_livraison custom-select" >\n                            <option value="-1">-</option>\n                        </select>\n                    </div>\n                    <div class="col-lg-12 mt-2">\n                        <div class="form-group">\n                            <span class="underline"><i class="fas fa-truck pr-2"></i>Livreur:</span>\n                            <div class="row pl-3 pr-3">\n                                <div class="col">\n                                    <div class="custom-control custom-radio">\n                                        <input type="radio" id="livreur1" value="interne" name="livreur" class="custom-control-input" checked>\n                                        <label class="custom-control-label" for="livreur1">Interne</label>\n                                    </div>\n                                </div>\n                                <div class="col">\n                                    <div class="custom-control custom-radio custom-checkbox-secondary">\n                                        <input type="radio" id="livreur2" value="externe" name="livreur" class="custom-control-input">\n                                        <label class="custom-control-label" for="livreur2">Externe</label>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="col-lg-12 mt-2">\n                        <label for="commande_tags"><span class="underline"><i class="fas fa-tag pr-2"></i>Tags:</span></label>\n                        <input type="text" id="commande_tags" name="commande_tags" class="form-control commande_tags" placeholder="Ajoutez vos Tags ici!" >\n                    </div>\n\n                </div>\n\n\n            </div>\n        </div>\n        <hr>\n        <div style="overflow-x: scroll" class="border border-dark rounded p-0">\n            <div class="p-0">\n                <table class="table table-striped p-0 text-center">\n                    <thead class="bg-dark-bright">\n                    <tr class="">\n                        <th>Article</th>\n                        <th>Description</th>\n                        <th>P.U</th>\n                        <th>Qte Cmd</th>\n                        <th>Qte Fact</th>\n                        <th>Thème</th>\n                        <th>Remise(%)</th>\n                        <th>Sous-total</th>\n                        <th></th>\n                    </tr>\n                    </thead>\n                    <tbody id="article_in_devis_cmd" data-ILink="'+t+'" data-link="'+a+'">\n\n                    </tbody>\n                </table>\n            </div>\n            <div class="text-center mb-3">\n                <div class="spinner-border text-primary m-auto spin_add_article_in_modif_cmd" role="status">\n                    <span class="sr-only">...</span>\n                </div>\n                <button type="button" id="add_article_in_modif_cmd" class="m-auto btn bg-info-bright hide add_article_in_modif_cmd"  onclick="manisyEnreeAnatyModification()">Ajouter un produit</button>\n            </div>\n        </div>\n\n\n        <hr>\n        <div class="row">\n            <div class="col-md-6 col-sm-6 col-xs-6">\n                <div class="m-3 m-auto p-3">\n                    <h4>Observation</h4>\n                    <label for="commande_observation">\n                        <textarea name="observation" class="form-control" placeholder="Vos observations ici..." id="commande_observation" cols="50" rows="2"></textarea>\n                    </label>\n                </div>\n            </div>\n            <div class="col-md-6 col-sm-6 col-xs-6">\n                <table id="totalOfOneCmd" class="table table-sm table-borderless">\n                    <tr>\n                        <th>Total CMD</th>\n                        <td class="text-right"><span id="total_of_article_added">0</span> ar</td>\n                    </tr>\n                    <tr>\n                        <th><label for="_frais_de_livraison">Frais de Livraison</label></th>\n                        <td><input type="number" id="_frais_de_livraison" value="0" name="commande_frais_de_livraison" class="form-control text-right"></td>\n                    </tr>\n                    <tr>\n                        <th><label for="_remiseExp">Remise exp</label></th>\n                        <td><input type="number" id="_remiseExp" disabled value="0" name="commande__remiseExp" class="form-control text-right"></td>\n                    </tr>\n                    <tr>\n                        <th><label for="_rfa">RFA</label></th>\n                        <td><input type="number" id="_rfa" value="0" disabled name="commande_rfa" class="form-control text-right"></td>\n                    </tr>\n                    <tr>\n                        <th><label for="_remiseGlobal">Remise Accordé</label></th>\n                        <td><input type="number" id="_remiseGlobal" value="0" name="commande_remiseGlobal" class="form-control text-right"></td>\n                    </tr>\n                    <tr>\n                        <th>Total à payer</th>\n                        <td class="text-right"><span id="totalAPayer">0</span> ar</td>\n                    </tr>\n                    <tr>\n                        <th><label for="_acompte">Acompte Payer</label></th>\n                        <td><input type="number" id="_acompte" name="commande_acompte" value="0" class="form-control text-right"></td>\n                    </tr>\n                    <tr class="hide">\n                        <th>Reste à payer</th>\n                        <td class="text-right"><span id="_reste">0</span> ar</td>\n                    </tr>\n                </table>\n            </div>\n        </div>\n\n\n        <hr>\n\n        <div class="text-right">\n            <button type="button" data-toggle="modal" onclick="facturation(\'modification_cmd_form\')" data-target="#modal_commande_facture" class="btn btn-light-secondary"> <i class="fas fa-eye pr-3"></i>Facturer</button>\n            <button type="submit" class="btn btn-light-primary"><i class="fas fa-save pr-3"></i>Enregistrer</button>\n        </div>\n')}))}function modificationDevis(e){$.get(e,(function(e){let t="modif_devis_form";$("#modif_ref_dev").html(e.ref),$("#refBcv_dev").html(e.refBcv_dev),$("#"+t+" #id_modif").val(e.id),$("#"+t+" #id_devis").val(e.id),$("#modif_user_dev").html(e.user),$("#modif_date_creation_dev").html(e.date_cmd),$("#modif_client").html('<option value="">'+e.client.designation+"</option>"),$(".fdev_cli").html(e.client.designation),$("#"+t+" #cmd_code_cli").val(e.client.code_cli),"Commandé"===e.statut?($("#modif_statut_dev").html('<span class="rounded p-1 bg-secondary-bright text-secondary">'+e.statut+"</span>"),$("button#cmdTriggerInDevis").addClass("hide")):$("#modif_statut_dev").html("Expiré"===e.statut?'<span class="rounded p-1 bg-dark text-danger">'+e.statut+"</span>":'<span class="rounded p-1 bg-success-bright text-success">'+e.statut+"</span>"),$("#"+t+" #cat_client").val(e.client.cat),_rfa=e.client.rfa,_rExp=e.client.rexp,_tva=e.client.tva,initEmptyDatePicker($(" #"+t+" #date_dmd, #"+t+" #date_exp")),$("#"+t+" #date_exp").val(e.date_exp),$("#"+t+" #date_dmd").val(e.date_dmd),$("#"+t+" #contact_client").val(e.client.contact),$("#"+t+" .add_article_in_devis_cmd").removeClass("hide"),$("#"+t+" .spin_add_article_in_devis_cmd").addClass("hide");let a=$("#"+t+" #devis_tags");a.val(e.tag),a.tagsinput("items"),0!==e.client.delai&&7!==e.client.delai&&15!==e.client.delai&&30!==e.client.delai&&60!==e.client.delai?($("#"+t+' #delai_p  input[value="-1"]').prop("checked",!0),$("#"+t+" #delai_p #input_other_delai").removeClass("hide"),$("#"+t+" #delai_p #autre_delai_payement").val(e.client.delai)):($("#"+t+" #delai_p #input_other_delai").addClass("hide"),$("#"+t+' #delai_p input[value="'+e.client.delai+'"]').prop("checked",!0));let l=$("#"+t+" #article_in_devis_cmd");l.html(""),e.liste_article.forEach((function(e,a){listOfPrice[""+a]=e.list_prix_action,l.append('<tr class="article" data-number="'+a+'"><td class="form-group"><select type="text" class="form-control produit" style="text-overflow:ellipsis; min-width: 160px" disabled id="produit_'+a+'"><option value="'+e.article_id+'">[+]'+e.designation+'</option></select><input type="hidden" value="'+e.article_id+'"  name="article['+a+'][article]"></td><td class="form-group"><textarea class="form-control" style="text-overflow:ellipsis;min-height: 35px; width: 150px" id="description_'+a+'" name="article['+a+'][description]" placeholder="Description">'+e.description+'</textarea></td><td class="form-group"><input type="number" class="form-control text-center" disabled value="'+e.pu+'" style="width: 100px" id="pu_'+a+'" name="article['+a+'][pu]" placeholder="P.U"><input type="hidden" value="'+e.pu+'" id="__pu_'+a+'" name="article['+a+'][pu]"></td><td class="form-group"><input type="number" class="form-control text-center" style="width: 80px" id="qte_'+a+'" value="'+e.qte_cmd+'" name="article['+a+'][qte]" placeholder="Qte"></td><td class="form-group"><select type="text" class="form-control action" id="action_'+a+'" name="article['+a+'][action]">                       <option value="0"> - </option>\n</td><td><input type="number" class="form-control text-center" style="width: 70px" id="remise_'+a+'" value="'+e.remise+'" name="article['+a+'][remise]" placeholder="%"></td><td class="form-group"><span class="sous-total" id="sousTotal_'+a+'">'+e.sous_total+'</span> Ar</td><td class="form-group"><div class="btn btn-outline-danger btn-sm remove_article_in_this" style="cursor: pointer;"><i class="ti-trash"></i></div></td></tr>'),action_selection=$("#"+t+" #action_"+a),action_selection.select2({data:e.list_action,multiple:!1,language:{noResults:function(){return"<div class='text-center'><span class='text-muted font-size-13'>Ooooo!!, pas de resultat! <i class='fas fa-smile'></i></span></div>"}},escapeMarkup:function(e){return e}}),action_selection.val(e.action).trigger("change"),$("#"+t+" .action").on("select2:select",(function(){let e=$(this).parent().parent().attr("data-number"),a=$("#action_"+e).select2("data")[0].id;switch($("#modal_commande_ajout #cat_client").val()){case"1":$("#"+t+" #pu_"+e).val(listOfPrice[e][a].pb2c);break;case"2":$("#"+t+" #pu_"+e).val(listOfPrice[e][a].pb2b);break}$("#"+t+" #__pu_"+e).val($("#pu_"+e).val()),updateSousTotal(t,e)})),updateSousTotal(t,a),updateIfChangement(t),removeArticleAdded(t)})),initEmptyDatePicker($("#"+t+" #date_livraison_commande")),$("#"+t+" #heure_livraison_commande").clockpicker({autoclose:!0}),politique_selection=$("#"+t+" select.politique"),politique_selection.select2({data:e.client.listPol,multiple:!1,language:{noResults:function(){return pl=$("#new_devis_form select.selectClient").attr("data-PLink"),typedInSelect=event.target.value,"<div class='text-center'><span class='text-muted font-size-13'>Ooooo!!, pas de resultat! <i class='fas fa-smile'></i></span><br><button type='button' onclick='createThisQuickly(politique_selection, pl)' class='btn create_this_article btn-sm btn-success'>Nouvelle politique ?</button></div>"}},escapeMarkup:function(e){return e}}),e.client.politique>0&&politique_selection.val(e.client.politique).trigger("change"),adress_selection=$("#"+t+" select.lieu_livraison"),adress_selection.select2({data:e.client.listAdress,multiple:!1,language:{noResults:function(){return ll=$("#new_devis_form select.selectClient").attr("data-LLink"),typedInSelect=event.target.value,"<div class='text-center'><span class='text-muted font-size-13'>Ooooo!!, pas de resultat! <i class='fas fa-smile'></i></span><br><button type='button' onclick='createThisQuickly(adress_selection, ll)' class='btn create_this_article btn-sm btn-success'>Nouvelle adresse ?</button></div>"}},escapeMarkup:function(e){return e}}),$("#"+t+" #mode_payement").select2({data:e.client.listModeP,multiple:!1}),listOfArticle=e.allArticle,listOfArticleCyrus=e.list_cyrus,$(".refDevis").html(e.ref),$("#"+t+" #_frais_de_livraison").val(e.frais_livr),$("#"+t+" #rfa_pc").val(e.rfa),$("#"+t+" #rexp_pc").val(e.rexp),$("#"+t+" #_remiseGlobal").val(e.remise),$("#"+t+" #totalAPayer").val(e.total),$("#"+t+" #devis_observation").val(e.observation),updateInCmd(t)})),$("#modal_devis_modify").on("hidden.bs.modal",(function(){let e=$("#new_cmd_form #article_in_devis_cmd"),t=e.attr("data-ILink"),a=e.attr("data-link");$("span#modif_ref_bcv").html("............."),$("span#modif_statut").html("..........."),$("span#modif_date_creation_bcv").html("..........."),$("span#modif_user").html("..........."),$("form#modification_cmd_form").html('<input type="hidden" id="id_modif" name="id_modif">\n        <div class="row">\n            <div class="col-8 border border-dark rounded p-4 mb-3">\n                <div class="row">\n                    <div class="col-6">\n                        <div class="form-group">\n                            <label for="modif_client">Client : </label>\n                            <select disabled class=" mt-2 custom-select form-control" id="modif_client">\n                                <option value=""></option></select>\n                        </div>\n                        <input type="hidden" name="code_client" id="cmd_code_cli">\n                    </div>\n                    <div class="col-3">\n                        <div class="form-group">\n                            <label for="cat_client">Tarification : </label>\n                            <select type="text" disabled class="form-control" id="cat_client" name="cat_client">\n                                <option value="1">B2C</option>\n                                <option value="2">B2B</option>\n                                <option value="3">SB2B</option>\n                            </select>\n                        </div>\n                    </div>\n                    <div class="col-3">\n                        <div class="form-group">\n                            <label for="contact_client">Contact : <i class="fas fa-phone"></i> || <i class="fas fa-envelope"></i> </label>\n                            <input type="text" id="contact_client" name="contact_client" class="form-control">\n                        </div>\n                    </div>\n                    <div class="col-12">\n                       <div class="row">\n                           <div class="col-9">\n                               <div class="form-group">\n                                   <label for="politique"><i class="fas fa-file-invoice"></i>  Politique de payement: </label>\n                                   <select id="politique" name="politique" class="form-control politique custom-select">\n                                       <option value="-1">-</option>\n                                   </select>\n                               </div>\n                           </div>\n                           <div class="col-3">\n                               <div class="form-group">\n                                   <label for="mode_payement"><i class="fas fa-file-invoice"></i>  Mode de payement: </label>\n                                   <select id="mode_payement" name="mode_payement" class="form-control mode_payement custom-select">\n                                        <option value="1">Espèce</option>\n                                    </select>\n                               </div>\n                           </div>\n                       </div>                    </div>\n                </div>\n\n\n                <div class="row" id="delai_p">\n                    <p class="underline col-12">Delai de payement : </p>\n                    <div class="col">\n                        <div class="custom-control custom-radio">\n                            <input type="radio" id="customRadio" value="0" name="delai_payement_client" class="custom-control-input" checked>\n                            <label class="custom-control-label" for="customRadio">Jours-J</label>\n                        </div>\n                    </div>\n                    <div class="col">\n                        <div class="custom-control custom-radio custom-checkbox-secondary">\n                            <input type="radio" id="customRadio1" value="7" name="delai_payement_client" class="custom-control-input">\n                            <label class="custom-control-label" for="customRadio1">7 jours</label>\n                        </div>\n                    </div>\n                    <div class="col">\n                        <div class="custom-control custom-radio custom-checkbox-success">\n                            <input type="radio" id="customRadio2" value="15" name="delai_payement_client" class="custom-control-input">\n                            <label class="custom-control-label" for="customRadio2">15 jours</label>\n                        </div>\n                    </div>\n                    <div class="col">\n                        <div class="custom-control custom-radio custom-checkbox-danger">\n                            <input type="radio" id="customRadio3" value="30" name="delai_payement_client" class="custom-control-input">\n                            <label class="custom-control-label" for="customRadio3">30 jours</label>\n                        </div>\n                    </div>\n                    <div class="col">\n                        <div class="custom-control custom-radio custom-checkbox-warning">\n                            <input type="radio" id="customRadio4" value="60" name="delai_payement_client" class="custom-control-input">\n                            <label class="custom-control-label" for="customRadio4">60 jours</label>\n                        </div>\n                    </div>\n                    <div class="col">\n                        <div class="custom-control custom-radio custom-checkbox-dark">\n                            <input type="radio" id="autreDelaiDeP" value="-1" name="delai_payement_client" class="custom-control-input">\n                            <label class="custom-control-label" for="autreDelaiDeP">autre</label>\n                        </div>\n                    </div>\n                    <div class="col-12 mt-3 text-center hide" id="input_other_delai">\n                        <input id="autre_delai_payement" type="text" name="autre_delai_payement" placeholder="Autres parmis ces choix...    ( en jours )" class="form-control">\n                        <label for="autre_delai_payement"></label>\n                    </div>\n                </div>\n\n            </div>\n            <div class="col-4 p-4 ">\n\n                <div class="row">\n                    <div class="col-lg-6">\n                        <div class="form-group text-center">\n                            <span class="underline"><i class="fas fa-calendar-day pr-2"></i>Date de livraison:</span>\n                            <label for="date_livraison_commande"><input id="date_livraison_commande" autocomplete="off" type="text" required name="date_livraison_commande" placeholder="Cliquez ici!" class="form-control"></label>\n                        </div>\n                    </div>\n                    <div class="col-lg-6">\n                        <div class="form-group text-center">\n                            <span class="underline"><i class="fas fa-clock pr-2"></i>Heure:</span>\n                            <label for="heure_livraison_commande"><input placeholder="Cliquez ici!" id="heure_livraison_commande" autocomplete="off" type="text" name="heure_livraison_commande" class="form-control"></label>\n                        </div>\n                    </div>\n                    <div class="col-lg-12">\n                        <label for="lieu_livraison"><span class="underline"><i class="fas fa-map-location pr-2"></i>Lieu de livraison :</span></label>\n                        <select id="lieu_livraison" name="lieu_livraison" required class="form-control lieu_livraison custom-select" >\n                            <option value="-1">-</option>\n                        </select>\n                    </div>\n                    <div class="col-lg-12 mt-2">\n                        <div class="form-group">\n                            <span class="underline"><i class="fas fa-truck pr-2"></i>Livreur:</span>\n                            <div class="row pl-3 pr-3">\n                                <div class="col">\n                                    <div class="custom-control custom-radio">\n                                        <input type="radio" id="livreur1" value="interne" name="livreur" class="custom-control-input" checked>\n                                        <label class="custom-control-label" for="livreur1">Interne</label>\n                                    </div>\n                                </div>\n                                <div class="col">\n                                    <div class="custom-control custom-radio custom-checkbox-secondary">\n                                        <input type="radio" id="livreur2" value="externe" name="livreur" class="custom-control-input">\n                                        <label class="custom-control-label" for="livreur2">Externe</label>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="col-lg-12 mt-2">\n                        <label for="commande_tags"><span class="underline"><i class="fas fa-tag pr-2"></i>Tags:</span></label>\n                        <input type="text" id="commande_tags" name="commande_tags" class="form-control commande_tags" placeholder="Ajoutez vos Tags ici!" >\n                    </div>\n\n                </div>\n\n\n            </div>\n        </div>\n        <hr>\n        <div style="overflow-x: scroll" class="border border-dark rounded p-0">\n            <div class="p-0">\n                <table class="table table-striped p-0 text-center">\n                    <thead class="bg-dark-bright">\n                    <tr class="">\n                        <th>Article</th>\n                        <th>Description</th>\n                        <th>P.U</th>\n                        <th>Qte Cmd</th>\n                        <th>Qte Fact</th>\n                        <th>Thème</th>\n                        <th>Remise(%)</th>\n                        <th>Sous-total</th>\n                        <th></th>\n                    </tr>\n                    </thead>\n                    <tbody id="article_in_devis_cmd" data-ILink="'+t+'" data-link="'+a+'">\n\n                    </tbody>\n                </table>\n            </div>\n            <div class="text-center mb-3">\n                <div class="spinner-border text-primary m-auto spin_add_article_in_modif_cmd" role="status">\n                    <span class="sr-only">...</span>\n                </div>\n                <button type="button" id="add_article_in_modif_cmd" class="m-auto btn bg-info-bright hide add_article_in_modif_cmd"  onclick="manisyEnreeAnatyModification()">Ajouter un produit</button>\n            </div>\n        </div>\n\n\n        <hr>\n        <div class="row">\n            <div class="col-md-6 col-sm-6 col-xs-6">\n                <div class="m-3 m-auto p-3">\n                    <h4>Observation</h4>\n                    <label for="commande_observation">\n                        <textarea name="observation" class="form-control" placeholder="Vos observations ici..." id="commande_observation" cols="50" rows="2"></textarea>\n                    </label>\n                </div>\n            </div>\n            <div class="col-md-6 col-sm-6 col-xs-6">\n                <table id="totalOfOneCmd" class="table table-sm table-borderless">\n                    <tr>\n                        <th>Total CMD</th>\n                        <td class="text-right"><span id="total_of_article_added">0</span> ar</td>\n                    </tr>\n                    <tr>\n                        <th><label for="_frais_de_livraison">Frais de Livraison</label></th>\n                        <td><input type="number" id="_frais_de_livraison" value="0" name="commande_frais_de_livraison" class="form-control text-right"></td>\n                    </tr>\n                    <tr>\n                        <th><label for="_remiseExp">Remise exp</label></th>\n                        <td><input type="number" id="_remiseExp" disabled value="0" name="commande__remiseExp" class="form-control text-right"></td>\n                    </tr>\n                    <tr>\n                        <th><label for="_rfa">RFA</label></th>\n                        <td><input type="number" id="_rfa" value="0" disabled name="commande_rfa" class="form-control text-right"></td>\n                    </tr>\n                    <tr>\n                        <th><label for="_remiseGlobal">Remise Accordé</label></th>\n                        <td><input type="number" id="_remiseGlobal" value="0" name="commande_remiseGlobal" class="form-control text-right"></td>\n                    </tr>\n                    <tr>\n                        <th>Total à payer</th>\n                        <td class="text-right"><span id="totalAPayer">0</span> ar</td>\n                    </tr>\n                    <tr>\n                        <th><label for="_acompte">Acompte Payer</label></th>\n                        <td><input type="number" id="_acompte" name="commande_acompte" value="0" class="form-control text-right"></td>\n                    </tr>\n                    <tr class="hide">\n                        <th>Reste à payer</th>\n                        <td class="text-right"><span id="_reste">0</span> ar</td>\n                    </tr>\n                </table>\n            </div>\n        </div>\n\n\n        <hr>\n\n        <div class="text-right">\n            <button type="button" data-toggle="modal" onclick="facturation(\'modification_cmd_form\')" data-target="#modal_commande_facture" class="btn btn-light-secondary"> <i class="fas fa-eye pr-3"></i>Facturer</button>\n            <button type="submit" class="btn btn-light-primary"><i class="fas fa-save pr-3"></i>Enregistrer</button>\n        </div>\n')}))}function passerCommande(){$("#cmdTriggerInDevis").addClass("hide"),$("#commanderDevis").removeClass("hide"),$("#plusInfoCmd").removeClass("hide")}function facturation(e){let t=$("#"+e+" #delai_p :checked").val()>=0?$("#"+e+" #delai_p input:checked").val():$("#"+e+" #autre_delai_payement").val();$("#fact_observation").on("change keyup",(function(){let t=$(this).val();$("#"+e+" #__fact_observation").val(t),$(".factb2cObs2").html(t),$(".factb2cObs1").html(t),$(".observationFact").html(t)})),$("#fact_delai").html(0===t?"Jour-J":t+" jours"),$(".fb2b_delaiP").html(0===t?"Jour-J":t+" jours"),$(".fb2c_delaiP").html(0===t?"Jour-J":t+" jours"),$(".fb2c_delaiP2").html(t);let a=$("#"+e+" #select2-selectClient_-container").html();$("#fact_cli").html(a),$(".fb2b_cli").html(a),$(".fb2c_cli").html(a),$(".fb2c_cli2").html(a),$(".bl_cli").html(a);let l=$("#"+e+" #contact_client").val();$("#fact_contact").html(l),$(".contact_cli").html(l),$(".fb2c_ctct_cli").html(l),$(".fb2c_ctct_cli2").html(l);let r=new Date,i=r.getDate()+"/"+(""+(parseInt(r.getMonth())+1)).padStart("2","0")+"/"+r.getFullYear();$(".dateFact").html(i),$(".b2c_df").html(i),$(".b2c_df2").html(i),$("#fact_cat").html($("#"+e+' #cat_client option[value="'+$("#"+e+" #cat_client").val()+'"]').html());let n=$("#"+e+' #politique option[value = "'+$("#"+e+" #politique").val()+'"]').html();$("#fact_politique").html(n);let o=$("#"+e+' #mode_payement option[value = "'+$("#"+e+" #mode_payement").val()+'"]').html();$("#fact_modeP").html(o),$(".mode_payement_bl").html(o),$(".modepb2b").html(o),$(".fb2c_modeP").html(o);let c=$("#"+e+" #date_livraison_commande").val();$("#fact_date_livraison_commande").val(c),$(".dateLivr").html(c),$(".b2c_dl").html(c),$(".b2c_dl2").html(c);let s=$("#"+e+" #heure_livraison_commande").val();$("#fact_heure_livraison_commande").val(s),$(".heureLivr").html(s),$(".b2c-hl").html(s),$(".b2c-hl2").html(s);let d=$("#"+e+" #lieu_livraison option[value = "+$("#"+e+" #lieu_livraison").val()+"]").html();$("#fact_lieu_livraison").val(d),$(".adressLivr").html(d),$(".b2c_adressLivr").html(d),$(".b2c_adressLivr2").html(d);let u=$("#fact_commande_tags"),m=$("#factTagToSend"),p=$("#factTagToSendModif");u.val($("#"+e+" #commande_tags ").val()),m.val(u.val()),p.val(u.val()),u.on("change",(function(){m.val(u.val()),p.val(u.val())}));let _=$("#"+e+" #_remiseGlobal").val();$("#fact_remiseGlobal").val(_),$(".fb2b_remAcc").html(_),$(".b2c_remAcc").html(_),$(".b2c_remAcc2").html(_);let v=$("#"+e+" #_remiseExp").val();$("#fact_remiseExp").val(v),$(".fb2b_remExp").html(v);let f=$("#"+e+" #_rfa").val();$("#fact_rfa").val(f),$(".fb2b_rfa").html(f);let h=$("#"+e+" #_acompte").val();$("#fact_acompte").val(h),$(".fb2b_acompte").html(format_number(h)),$(".b2c_acompte").html(format_number(h)),$(".b2c_acompte2").html(format_number(h));let b=$("#"+e+" #_frais_de_livraison").val();$("#fact_frais_de_livraison").val(b),$(".fb2b_frais").html(format_number(b)),$(".b2c_frais").html(format_number(b)),$(".b2c_frais2").html(format_number(b));let g=$("#"+e+" #total_of_article_added").html();$("#fact_total").html(g),$(".fb2b_totalCmd").html(g),$(".b2c_sTotal").html(g),$(".b2c_sTotal2").html(g);let y=$("#"+e+" #refBCClient").val();$(".fb2brefBCClient").html(y);let x=$("#"+e+" #totalAPayer").html();$("#fact_total_a_payer").html(),$(".fb2b_totalnet").html(x),$(".b2c_total").html(x),$(".b2c_total2").html(x);let C=$("#"+e+" #_reste").html();$("#fact_reste").html(C),$(".fb2b_reste").html(C),$(".b2c_reste").html(C),$(".b2c_reste2").html(C);let k=$("#article_in_fact_devis_cmd"),q=$("#fb2bListArt"),B=$("#fb2cListArt"),A=$("#fb2cCliListArt"),F=$("#blListArt");F.html(""),k.html(""),q.html(""),A.html(""),B.html("");let w=$("#"+e+" #modif_statut span").html(),M=$("#"+e+" #article_in_devis_cmd tr").length;for(let t=0;t<M;t++){let a=$("#"+e+" #article_in_devis_cmd tr.article:nth-child("+(t+1)+")").attr("data-number"),l=null,r=(""+$("#"+e+" #produit_"+a+' option[value="'+$("#"+e+" #produit_"+a).val()+'"]').html().split("]")[1]).trim(),i=$("#"+e+" #description_"+a).val(),n=$("#"+e+" #pu_"+a).val(),o=$("#"+e+" #qte_"+a).val(),c=$(".qte_fact#qte_fact_"+a),s=void 0===c?o:c.val();function R(e){let t=e.designation.trim();r==t&&(l=e,s=void 0!==c.val()&&"Commandé"!==w?null!=e.stockReel&&o>e.stock?e.stockReel:c.val():null!=e.stockReel&&o>e.stock?e.stockReel:o)}listOfArticleCyrus.find(R);let d=$("#"+e+" #remise_"+a).val(),u=$("#"+e+" #action_"+a+' option[value="'+$("#"+e+" #action_"+a).val()+'"]').html();$("#"+e+" #cmd_qte_fact_"+a).val(s),$("#"+e+" #qte_fact_"+a).val(s),k.append('<tr class="fact_article" data-number="'+a+'">\n                                        \x3c!-- produit --\x3e\n                                        <td class="form-group">\n                                            '+r+'\n                                        </td>\n                                        \x3c!-- Description --\x3e\n                                        <td class="form-group" style="white-space: pre-wrap">\n                                            '+i+'\n                                        </td>\n                                        \x3c!-- PU --\x3e\n                                        <td class="form-group">\n                                            <span id="f_pu_'+a+'">'+format_number(n)+'</span> ar\n                                        </td>\n                                        \x3c!-- Quantité cmd--\x3e\n                                        <td class="form-group">\n                                            '+o+'\n                                        </td>\n                                        \x3c!-- Quantité V--\x3e\n                                        <td class="form-group">\n                                            <input type="number" min="0" max="'+o+'" class="form-control cmd_qte_fct" value="'+s+'" style="width: 80px" id="f_qte_'+a+'" placeholder="Qte">\n                                        </td>\n                                        \x3c!-- Quantité echatillion--\x3e\n                                        <td class="form-group">\n                                            <input type="number" class="form-control" value="0" style="width: 80px" id="f_echant_'+a+'" placeholder="Qte echantillion">\n                                        </td>\n                                        \x3c!-- Action --\x3e\n                                        <td class="form-group">\n                                            '+u+'\n                                        </td>\n                                        \x3c!-- Remise--\x3e\n                                        <td>\n                                            <span id="f_rem_'+a+'">'+d+'</span>%\n                                        </td>\n                                        \x3c!-- SousTotal --\x3e\n                                        <td class="form-group">\n                                            <span class="fact_sousTotal_'+a+' fst">'+format_number(n*s-n*s*d/100)+" </span> Ar\n                                        </td>\n                                    </tr>"),F.append('                  <tr class="text-center">\n                                    <td class="border border-dark">'+r+'</td>\n                                    <td class="border border-dark">'+o+'</td>\n                                    <td class="border border-dark qtfBl_'+a+'">'+s+'</td>\n                                    <td class="border border-dark qtEchBl_'+a+'"></td>\n                                    <td class="border border-dark">'+format_number(n)+"</td>\n                                </tr>"),q.append('           <tr class="text-center">\n                                <td class="border border-dark">'+l.depot+'</td>\n                                <td class="border border-dark">'+l.code+'</td>\n                                <td class="border border-dark font-weight-bold qtfB2b_'+a+' font-size-18">'+s+'</td>\n                                <td class="border border-dark">'+r+'</td>\n                                <td class="text-right border border-dark font-size-16">'+format_number(n)+'</td>\n                                <td class="text-right border border-dark totB2b_'+a+' font-size-16">'+format_number(n*s-n*s*d/100)+"</td>\n                            </tr>"),B.append('<tr>\n                                    <td class="border border-dark">'+l.depot+'</td>\n                                    <td class="border border-dark">'+l.ctn+'</td>\n                                    <td class="border border-dark">'+r+'</td>\n                                    <td style="white-space: pre-wrap" class="border border-dark">'+i+'</td>\n                                    <td class="text-right border border-dark qtfB2c_'+a+'">'+s+'</td>\n                                    <td class="text-right border border-dark cqtEchBl_'+a+'"></td>\n                                    <td class="text-right border border-dark">'+format_number(n)+'</td>\n                                    <td class="text-right border border-dark totB2c_'+a+'">'+format_number(n*s-n*s*d/100)+"</td>\n                                </tr>"),A.append('<tr>\n                                        <td class="border border-dark text-center">'+r+'</td>\n                                        <td class="border border-dark qtfB2c2_'+a+'">'+s+'</td>\n                                        <td class="border border-dark">'+format_number(n)+'</td>\n                                        <td class="border border-dark 2totB2c_'+a+'">'+format_number(n*s-n*s*d/100)+"</td>\n                                    </tr>")}updateInfact(e),$(".fact_article").on("change keyup",(function(){let t=$(this).attr("data-number"),a=parseInt($("#f_pu_"+t).html().replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(",",".")),l=$("#f_qte_"+t).val(),r=parseInt($("#f_rem_"+t).html().replace(" ","").replace(" ","").replace(",",".")),i=Math.round(a*l-a*l*(r/100)),n=$("#f_echant_"+t).val();$(".fact_sousTotal_"+t).html(format_number(i)),$(".totB2b_"+t).html(format_number(i)),$(".totB2c_"+t).html(format_number(i)),$(".2totB2c_"+t).html(format_number(i)),$(".qtfBl_"+t).html(l),$(".qtfB2b_"+t).html(l),$(".qtfB2c_"+t).html(l),$(".qtfB2c2_"+t).html(l),$(".qtEchBl_"+t).html(n),$(".cqtEchBl_"+t).html(n),$("#"+e+" #cmd_qte_fact_"+t).val(l),$("#"+e+" #qte_fact_"+t).val(l),$("#"+e+" #cmd_qte_ech_"+t).val(n),updateInfact(e),updateSousTotal(e,t),updateInCmd(e)})),$("#fact_acompte, #fact_remiseGlobal").on("change keyup",(function(){updateInfact(e)}))}function updateInfact(e){let t=$("#article_in_fact_devis_cmd tr .fst"),a=0;t.each((function(e,t){let l=0;isNaN(parseFloat(t.innerHTML))||(l=parseFloat(t.innerHTML.replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(",",".").replace(",","."))),a+=l})),$("#fact_total").html(format_number(a)),$(".fb2b_totalCmd").html(format_number(a)),$(".b2c_sTotal").html(format_number(a)),$(".b2c_sTotal2").html(format_number(a));let l=$("#fact_frais_de_livraison").val(),r=$("#fact_remiseGlobal").val(),i=$("#fact_acompte").val(),n=0,o=0;3==$("#"+e+" #cat_client").val()&&(n=Math.round(3*a/100),o="sm"===$("#select2-selectClient_-container").html()?Math.round(2*a/100):0);let c=a+parseFloat(l)-parseFloat(r)-n-o,s=c-parseFloat(i);$("#_frais_de_livraison").val(l),$("#_remiseGlobal").val(r),$("#_acompte").val(i),updateInCmd(e),$("#fact_remiseExp").val(o),$(".fb2b_remExp").html(o),$("#fact_rfa").val(n),$(".fb2b_rfa").html(n),$("#fact_total_a_payer").html(format_number(c)),$(".fb2b_totalnet").html(format_number(c)),$(".b2c_total").html(format_number(c)),$(".b2c_total2").html(format_number(c)),$("#fact_reste").html(format_number(s)),$(".fb2b_reste").html(format_number(s)),$(".b2c_reste").html(format_number(s)),$(".b2c_reste2").html(format_number(s)),$(".fb2b_acompte").html(format_number(parseFloat(i))),$(".b2c_acompte").html(format_number(parseFloat(i))),$(".b2c_acompte2").html(format_number(parseFloat(i))),$("#tot_ltr_b2b").html(NumberToLetter(s))}function dropzoneExists(e){return $(e).hasClass("dz-clickable")}function getFactImg(){if("b2c"==$("#fact_cat").html().toLocaleLowerCase()||"b2c"===$("#suivi_facture_form span#_catFacture").html()){$("#fact_b2c_container").html('<div class="spinner-grow text-dark" role="status">\n                        <span class="sr-only">Chargement...</span>\n                    </div>\n                    <div class="spinner-grow text-dark" role="status">\n                    </div>\n                    <div class="spinner-grow text-dark" role="status">\n                    </div>\n                    <div class="spinner-grow text-dark" role="status">\n                    </div>'),$("#modal_fact_b2c").modal("show");let e=document.getElementById("print_fact_b2c");htmlToImage.toJpeg(e,{quality:1}).then((function(e){let t=new Image;t.src=e,t.className="img-fluid",$("#fact_b2c_container").html(t)})).catch((function(e){swal("Oops, erreur!","Contacter votre technicien!","error")}))}else printJS({printable:"print_fact_b2b",type:"html",scanStyles:!1,css:[""+$("#1__").attr("data-link"),""+$("#2__").attr("data-link"),""+$("#3__").attr("data-link"),""+$("#4__").attr("data-link")]})}function voirFacture(e){$.get(e,(function(e){$("#_refFacture").html(e.ref),$("#print_fact_avoir .refFact").html(e.ref+"|AV"),$(".refFact").html(e.ref),$(".b2c_ref_fact2").html(e.ref),$(".b2c_ref_fact").html(e.ref),$("#_date_creation_facture").html(e.dateFacturation),$(".dateEcheanceDeRec").html(e.dateEcheance),$(".magasinDeRec").html(e.client.magasin),$(".joursRestEcheanceDeRec").html(e.resteJ);let t=new Date,a=t.getDate()+"/"+(""+(parseInt(t.getMonth())+1)).padStart("2","0")+"/"+t.getFullYear();if($("#print_fact_avoir .dateFact").html(a),$(".dateFact").html(a),$(".b2c_df").html(a),$(".b2c_df2").html(a),$(".refBcv").html(e.bcv),$(".b2c_refBcv").html(e.bcv),$("#_dateCommandeFacture").html(e.dateCommande),$("#_responsableFacture").html(e.user),$("#id_facture").val(e.id),$("#_clientFacture").html(e.client.designation),$("#print_fact_avoir .fav_cli").html(e.client.designation),$(".fb2b_cli").html(e.client.designation),$(".fb2c_cli").html(e.client.designation),$(".fb2c_cli2").html(e.client.designation),$("#_catFacture").html(e.client.cat),$("#fact_cat").html(e.client.cat),$("#_contactFacture").html(e.client.contact),$("#print_fact_avoir .fav_contact").html(e.client.contact),$(".code_cli").html(e.client.code),$(".fb2c_code_cli").html(e.client.code),$(".fb2c_ctct_cli").html(e.client.contact),$(".fb2c_ctct_cli2").html(e.client.contact),$("#_delaiFacture").html(e.client.delai),$("#print_fact_avoir .fav_delaiP").html(e.client.delai),$(".fb2b_delaiP").html(0===e.client.delai?"Jour-J":e.client.delai+" jours"),$(".fb2c_delaiP").html(0===e.client.delai?"Jour-J":e.client.delai+" jours"),$(".fb2c_delaiP2").html(e.client.delai),$("#_modePFacture").html(e.client.modePayement),$("#print_fact_avoir .modepfav").html(e.client.modePayement),$(".mode_payement_bl").html(e.client.modePayement),$(".modepb2b").html(e.client.modePayement),$(".fb2c_modeP").html(e.client.modePayement),$("#_politiqueFacture").html(e.client.politique),$("#date_heure_facture").html(e.dateLivraison+" | "+e.heureLivraison),$(".dateLivr").html(e.dateLivraison),$(".b2c_dl").html(e.dateLivraison),$(".b2c_dl2").html(e.dateLivraison),$(".heureLivr").html(e.heureLivraison),$(".b2c-hl").html(e.heureLivraison),$(".b2c-hl2").html(e.heureLivraison),$("#_livreurFacture").html(e.livreur),$("#_lieuFacture").html(e.lieu),$("#print_fact_avoir .adressLivr").html(e.lieu),$(".lieuDeRec").html(e.lieu),$(".adressLivr").html(e.lieu),$(".b2c_adressLivr").html(e.lieu),$(".b2c_adressLivr2").html(e.lieu),$("#_observationFacture").val(e.observation),$(".observationFact").val(e.observation),$(".factb2cObs1").val(e.observation),$(".factb2cObs2").val(e.observation),$("#total_inCmd").html(format_number(e.inCmd.total)),$("#frais_inCmd").html(format_number(e.inCmd.frais)),$("#rfa_inCmd").html(format_number(e.inCmd.rfa)),$("#rexp_inCmd").html(format_number(e.inCmd.rexp)),$("#racc_inCmd").html(format_number(e.inCmd.racc)),$("#totalApayer_inCmd").html(format_number(e.inCmd.totalAPayer)),$("#acompte_inCmd").html(format_number(e.inCmd.acompte)),$("#reste_inCmd").html(format_number(e.inCmd.reste)),$("#total_inFact").html(format_number(e.inFact.total)),$(".fb2b_totalCmd").html(format_number(e.inFact.total)),$(".b2c_sTotal").html(format_number(e.inFact.total)),$(".b2c_sTotal2").html(format_number(e.inFact.total)),$("#frais_inFact").html(format_number(e.inFact.frais)),$(".fb2b_frais").html(format_number(e.inFact.frais)),$(".b2c_frais").html(format_number(e.inFact.frais)),$(".b2c_frais2").html(format_number(e.inFact.frais)),$("#rfa_inFact").html(format_number(e.inFact.rfa)),$(".fb2b_rfa").html(format_number(e.inFact.rfa)),$("#rexp_inFact").html(format_number(e.inFact.rexp)),$(".fb2b_remExp").html(format_number(e.inFact.rexp)),$("#racc_inFact").html(format_number(e.inCmd.racc)),$(".fb2b_remAcc").html(format_number(e.inCmd.racc)),$(".b2c_remAcc").html(format_number(e.inCmd.racc)),$(".b2c_remAcc2").html(format_number(e.inCmd.racc)),$("#totalApayer_inFact").html(format_number(e.inFact.totalAPayer)),$(".fb2b_totalnet").html(format_number(e.inFact.totalAPayer)),$(".b2c_total").html(format_number(e.inFact.totalAPayer)),$(".b2c_total2").html(format_number(e.inFact.totalAPayer)),$("#acompte_inFact").html(format_number(e.inCmd.acompte)),$(".fb2b_acompte").html(format_number(e.inCmd.acompte)),$(".b2c_acompte").html(format_number(e.inCmd.acompte)),$(".b2c_acompte2").html(format_number(e.inCmd.acompte)),$("#reste_inFact").html(format_number(e.inFact.reste)),$("#print_fact_avoir .fav_restant").html(format_number(e.inFact.reste)),$(".fb2b_reste").html(format_number(e.inFact.reste)),$(".b2c_reste").html(format_number(e.inFact.reste)),$(".b2c_reste2").html(format_number(e.inFact.reste)),$("#tot_ltr_b2b").html(NumberToLetter(e.inFact.reste)),$("#etatFactureAvoir").val(e.avoir),$("#_statutFacture").html('<span class="rounded p-1 '+("Pour suivi"===e.statut?"bg-danger-bright text-danger":"bg-success-bright text-success")+'">'+e.statut+"</span>"),$("#_factAvoirFacture").html('<span class="rounded p-1 '+("non"===e.avoir?"bg-dark text-success":"bg-dark text-danger")+'">'+e.avoir+"</span>"),$("#_etatLivrFacture").html('<span class="rounded p-1 '+("à preparer"===e.etatLivraison?"bg-secondary-bright text-secondary":"Reporté"===e.etatLivraison?"bg-danger":"bg-warning-bright text-warning")+'">'+e.etatLivraison+"</span>"),$("#_etatPayeFacture").html('<span class="rounded p-1 '+("à recouvrer"===e.recouvrement?"bg-danger-bright text-danger":"bg-success-bright text-success")+'">'+e.recouvrement+"</span>"),"à recouvrer"===e.recouvrement){$(".couleurCardVersement").addClass("bg-light").removeClass("bg-success").removeClass("bg-danger");let t=$("#refPayementInRec"),a=$("#montantRecouvrer"),l=$(".reccancelBtn");$(".recToogleBtn").on("click",(function(){$(".recToogleBtn").addClass("hide"),l.removeClass("hide"),$(".couleurCardVersement").addClass("bg-dark").removeClass("bg-success").removeClass("bg-light"),t.prop("required",!0),t.prop("disabled",!1),a.prop("disabled",!1),$("#isRecouvrement").val(1)})),l.on("click",(function(){$(".recToogleBtn").removeClass("hide"),l.addClass("hide"),t.prop("required",!1),t.prop("disabled",!0),a.prop("disabled",!0)})),a.on("change keyup",(function(){let t=$(this).val(),a=e.inFact.reste-t;$("#resteRecouvrer").val(a)}))}else $(".couleurCardVersement").addClass("bg-success").removeClass("bg-danger"),$("#resteRecouvrer").val(e.resteAreC),$("#refPayementInRec").val(e.refRec),$("#montantRecouvrer").val(e.montantRec);let l=$("#fb2bListArt"),r=$("#fb2cListArt"),i=$("#fb2cCliListArt"),n=$("#list_article_in_detailsFacture");l.html(""),i.html(""),r.html(""),n.html("");let o=[],c=[];function s(){$(".remove_articleRetour").click((function(e){e.preventDefault(),$(this).parent().parent().remove(),u()}))}function d(e){let t=$("#retour_pu_"+e).val(),a=$("#retour_remise_"+e).val(),l=$("#retour_qte_retour_"+e).val(),r=t*l-t*l*a/100;$("#retour_sousTotal_"+e).html(format_number(r)),u()}function u(){let t=$("#articleRetour_in_fact tr .sous-total"),a=0;t.each((function(e,t){let l=0;isNaN(parseFloat(t.innerHTML))||(l=parseFloat(t.innerHTML.replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(",",".").replace(",","."))),a+=l})),$("#total_retour").html(format_number(a));let l=$("#racc_retour").val(),r=Math.round(100*e.inFact.rfa/e.inFact.total),i=Math.round(100*e.inFact.rexp/e.inFact.total),n=Math.round(a*r/100),o=Math.round(a*i/100),c=a-parseFloat(l)-n-o,s=e.inFact.reste-c;$("#print_fact_avoir .fav_rembourse").html(format_number(s)),s<0?$("span#reste_retour").addClass("bg-danger-bright text-danger").removeClass("bg-success-bright text-success"):$("span#reste_retour").removeClass("bg-danger-bright text-danger").addClass("bg-success-bright text-success"),$("#totalApayer_retour").html(format_number(c)),$("#reste_retour").html(format_number(s)),$("#rfa_retour").html(format_number(n)),$("#rexp_retour").html(format_number(o))}e.articles.forEach((function(e,t){c[""+e.article_id]=e,o[""+t]={id:e.article_id,text:"["+e.codeA+"]"+e.designation},n.append('<tr class="article" data-number="'+t+'"><td class="form-group"><select type="text" class="form-control produit" style="text-overflow:ellipsis; min-width: 160px" disabled id="produit_'+t+'"><option value="'+e.article_id+'">[+]'+e.designation+'</option></select></td><td class="form-group"><textarea class="form-control" disabled style="text-overflow:ellipsis;min-height: 35px; width: 150px" id="description_'+t+'"  placeholder="Description">'+e.description+'</textarea></td><td class="form-group"  style="white-space: pre-wrap"><input type="number" class="form-control text-center" disabled value="'+e.pu+'" style="width: 100px" id="pu_'+t+'" placeholder="P.U"></td><td class="form-group"><input type="number" class="form-control text-center" disabled style="width: 80px" id="qte_'+t+'" value="'+e.qte_cmd+'" placeholder="Qte"></td><td class="form-group"><input type="number" class="form-control text-center" disabled style="width: 80px" id="qte_'+t+'" value="'+e.qte_fact+'" placeholder="Qte"></td><td class="form-group"><input type="number" class="form-control text-center" disabled style="width: 80px" id="qte_'+t+'" value="'+e.qte_ech+'" placeholder="Qte"></td><td class="form-group"><select disabled style="width: 150px" class="form-control action" id="action_'+t+'">                       <option> '+e.action+' </option>\n</td><td><input type="number" disabled class="form-control text-center" style="width: 70px" id="remise_'+t+'" value="'+e.remise+'" name="article['+t+'][remise]" placeholder="%"></td><td class="form-group"><span class="sous-total" id="sousTotal_'+t+'">'+format_number(Math.round(e.qte_cmd*e.pu-e.qte_cmd*e.pu*e.remise/100))+'</span></td><td class="form-group"><span class="sous-total" id="sousTotal_'+t+'">'+format_number(Math.round(e.qte_fact*e.pu-e.qte_fact*e.pu*e.remise/100))+"</span></td>"),l.append('           <tr class="text-center">\n                                <td class="border border-dark">'+e.depot+'</td>\n                                <td class="border border-dark">'+e.codeA+'</td>\n                                <td class="border border-dark font-weight-bold font-size-18">'+e.qte_fact+'</td>\n                                <td class="border border-dark">'+e.designation+'</td>\n                                <td class="text-right border border-dark font-size-16">'+format_number(e.pu)+'</td>\n                                <td class="text-right border border-dark font-size-16">'+format_number(e.pu*e.qte_fact-e.pu*e.qte_fact*e.remise/100)+"</td>\n                            </tr>"),r.append('<tr>\n                                    <td class="border border-dark">'+e.depot+'</td>\n                                    <td class="border border-dark">'+e.ctn+'</td>\n                                    <td class="border border-dark">'+e.designation+'</td>\n                                    <td class="border border-dark" style="white-space: pre-wrap">'+e.description+'</td>\n                                    <td class="text-right border border-dark">'+e.qte_fact+'</td>\n                                    <td class="text-right border border-dark">'+e.qte_ech+'</td>\n                                    <td class="text-right border border-dark">'+format_number(e.pu)+'</td>\n                                    <td class="text-right border border-dark">'+format_number(e.pu*e.qte_fact-e.pu*e.qte_fact*e.remise/100)+"</td>\n                                </tr>"),i.append('<tr>\n                                        <td class="border border-dark text-center">'+e.designation+'</td>\n                                        <td class="border border-dark">'+e.qte_fact+'</td>\n                                        <td class="border border-dark">'+format_number(e.pu)+'</td>\n                                        <td class="border border-dark">'+format_number(e.pu*e.qte_fact-e.pu*e.qte_fact*e.remise/100)+"</td>\n                                    </tr>")})),"non"!==e.avoir?($("button#cancelCreationOfFactAvoir").addClass("hide"),$("#contentOfFactureAvoir").removeClass("hide"),$("#factureAvoirTrigger").addClass("hide"),e.articlesinFa.forEach((function(e,t){let a=t+1;$("#articleRetour_in_fact").append('<tr class="articleRetour" data-number="'+a+'"><td class="form-group"><select class="form-control produit" disabled style="text-overflow:ellipsis;" id="retour_produit_'+a+'"><option value="'+e.id+'">['+e.code+"]"+e.designation+'</option></select><input value="'+e.id+'" type="hidden" name="articleRetour['+a+'][article]"></td><td class="form-group"><input type="number" class="form-control text-center" disabled value="'+e.pu+'" style="width: 100px" id="retour_pu_'+a+'" placeholder="P.U"></td><td class="form-group"><input type="number" class="form-control text-center" style="width: 80px" disabled id="retour_qte_'+a+'" value="'+e.qte_fact+'"></td><td class="form-group"><input type="number" class="form-control text-center" min="0" style="width: 80px" id="retour_qte_retour_'+a+'" value="'+e.qte_retour+'" name="articleRetour['+a+'][qte_retour]" placeholder="Qte"></td><td class="form-group"><span id="retour_action_'+a+'" >'+e.action+'</span></td><td><span id="retour_remise_'+a+'" >'+e.remise+'</span></td><td class="form-group"><span class="sous-total" id="retour_sousTotal_'+a+'">'+e.sousTotal+'</span></td><td class="form-group"><div class="btn btn-outline-danger btn-sm remove_articleRetour" style="cursor: pointer;"><i class="ti-trash"></i></div></td></tr>')})),$("#racc_retour").val(e.remiseRetour),u()):($("#creerFactureDAvoir").on("click",(function(){$("#_factAvoirFacture").html('<span class="rounded p-1 bg-dark text-danger">Oui</span>'),$("#etatFactureAvoir").val("oui"),$("#contentOfFactureAvoir").removeClass("hide"),$("#factureAvoirTrigger").addClass("hide")})),$("#cancelCreationOfFactAvoir").on("click",(function(){$("#contentOfFactureAvoir").addClass("hide"),$("#factureAvoirTrigger").removeClass("hide"),$("#articleRetour_in_fact").html(" "),$("#total_retour").html("0"),$("#rfa_retour").html("0"),$("#rexp_retour").html("0"),$("#racc_retour").html("0"),$("#totalApayer_retour").html("0"),$("#reste_retour").html("0"),$("#etatFactureAvoir").val("non"),$("#_factAvoirFacture").html('<span class="rounded p-1 bg-dark text-success">non</span>')}))),$("#addArticleRetour").on("click",(function(){let e=$("#articleRetour_in_fact"),t=e.children().length+1;e.append('<tr class="articleRetour" data-number="'+t+'"><td class="form-group"><select class="form-control produit" name="articleRetour['+t+'][article]" style="text-overflow:ellipsis;" id="retour_produit_'+t+'"><option>Choisir un article...</option></select></td><td class="form-group"><input type="number" class="form-control text-center" disabled value="0" style="width: 100px" id="retour_pu_'+t+'" placeholder="P.U"></td><td class="form-group"><input type="number" class="form-control text-center" style="width: 80px" disabled id="retour_qte_'+t+'" value="1"></td><td class="form-group"><input type="number" class="form-control text-center" min="0" style="width: 80px" id="retour_qte_retour_'+t+'" value="1" name="articleRetour['+t+'][qte_retour]" placeholder="Qte"></td><td class="form-group"><span id="retour_action_'+t+'" ></span></td><td><span id="retour_remise_'+t+'" ></span></td><td class="form-group"><span class="sous-total" id="retour_sousTotal_'+t+'">0</span></td><td class="form-group"><div class="btn btn-outline-danger btn-sm remove_articleRetour" style="cursor: pointer;"><i class="ti-trash"></i></div></td></tr>'),s();let a=$("#suivi_facture_form #retour_produit_"+t);a.select2({data:o,language:{noResults:function(){return"<div class='text-center'><span class='text-muted font-size-13'>Ooooo!!, pas de resultat! <i class='fas fa-smile'></i></span><br><a href='"+$("#article_url").attr("href")+"' target=\"_blank\" class='btn create_this_article btn-sm btn-success'>Page article ?</a></div>"}},escapeMarkup:function(e){return e}}),a.on("select2:select",(function(){let e=$(this).parent().parent().attr("data-number"),t=$(this).val();$("#retour_pu_"+e).val(c[""+t].pu),$("#retour_qte_"+e).val(c[""+t].qte_fact),$("#retour_qte_retour_"+e).attr("max",c[""+t].qte_fact),$("#retour_action_"+e).html(c[""+t].action),$("#retour_remise_"+e).html(c[""+t].remise),d(e)})),$(".articleRetour").on("change keyup",(function(){d($(this).attr("data-number"))}))})),s(),$(".updateTotalFactureDAvoir").on("change keyup",(function(){u()})),$(".spin_in_detailsFacture").addClass("hide")}))}function getFactAvoir(){let e="suivi_facture_form";$(".fav_totalCmd").html($("#"+e+" #total_retour").html()),$(".fav_rfa").html($("#"+e+" #rfa_retour").html()),$(".fav_remAcc").html(format_number($("#"+e+" #racc_retour").val())),$(".fav_remExp").html($("#"+e+" #rexp_retour").html()),$(".observationDev").html($("#"+e+" #devis_observation").val());let t=parseInt($("#"+e+" #totalApayer_retour").html().replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(",",".").replace(",","."));$(".fav_totalnet").html(format_number(t)),$("#tot_ltr_fav").html(NumberToLetter(t));let a=$("#"+e+" #articleRetour_in_fact tr").length;$("#favListArt").html(" ");for(let t=1;t<=a;t++){let a=(""+$("#"+e+" #retour_produit_"+t+' option[value="'+$("#"+e+" #retour_produit_"+t).val()+'"]').html().split("]")[1]).trim(),l=(""+$("#"+e+" #retour_produit_"+t+' option[value="'+$("#"+e+" #retour_produit_"+t).val()+'"]').html().split("]")[0]).split("[")[1].trim(),r=$("#"+e+" #retour_pu_"+t).val(),i=$("#"+e+" #retour_qte_retour_"+t).val(),n=r*i;$("#favListArt").append('<tr class="border border-dark">\n                            <td class="border border-dark">'+l+'</td>\n                            <td class="border border-dark">'+i+'</td>\n                            <td class="border border-dark">'+a+'</td>\n                            <td class="border border-dark">'+r+'</td>\n                            <td class="border border-dark">'+n+"</td>\n                        </tr>")}printJS({printable:"print_fact_avoir",type:"html",scanStyles:!1,css:[""+$("#1__").attr("data-link"),""+$("#2__").attr("data-link"),""+$("#3__").attr("data-link"),""+$("#4__").attr("data-link")]})}var minDate,maxDate;$("#new_devis_cmd").click((function(){let e="#modal_commande_ajout"===$(this).attr("data-target")?"new_cmd_form":"new_devis_form",t=$("#"+e+" select.selectClient"),a=t.attr("data-link"),l=t.attr("data-QLink");pLink=t.attr("data-PLink"),lLink=t.attr("data-LLink");let r=$("#"+e+" #article_in_devis_cmd").attr("data-link");function i(){t.select2({data:listOfClient,language:{noResults:function(){return client_select=t,ql=l,cat_cli=$("#"+e+" select#cat_client").val(),typedInSelect=event.target.value,"<div class='text-center'><span class='text-muted font-size-13'>Ooooo!!, pas de resultat! <i class='fas fa-smile'></i></span><br><button type='button' onclick='createThisQuickly(client_select, ql, cat_cli)' class='btn create_this_article btn-sm btn-success'>en créer ?</button></div>"}},escapeMarkup:function(e){return e}})}$("#"+e+" input.devis_tags, #fact_commande_tags, #"+e+" input.commande_tags").tagsinput("items"),null===listOfClient?$.post(a,{},(function(e){listOfClient=e,i()})):i(),null===listOfArticle?$.post(r,{},(function(t){listOfArticle=t.list,listOfArticleCyrus=t.list_cyrus;let a=new Date,l="BCV"+(""+a.getFullYear()).substr(2)+(""+(a.getMonth()+1)).padStart(2,"0")+(""+(t.lastCmd+1)).padStart(4,"0"),r="INV"+(""+a.getFullYear()).substr(2)+(""+(a.getMonth()+1)).padStart(2,"0")+(""+(t.lastFact+1)).padStart(4,"0");mode_payement_selection=$("#"+e+" select.mode_payement"),mode_payement_selection.select2({data:t.mode_payement?t.mode_payement:[],multiple:!1});let i="Q"+(""+a.getFullYear()).substr(2)+(""+(a.getMonth()+1)).padStart(2,"0")+(""+(t.lastDev+1)).padStart(4,"0");$(".refDevis").html(i),$("span#newBCV").html(l),$("span#newFact").html(r),$(".refFact").html(r),$(".b2c_ref_fact").html(r),$(".b2c_ref_fact2").html(r),$(".refBcv").html(l),$(".b2c_refBcv").html(l),$("#"+e+" .add_article_in_devis_cmd").removeClass("hide"),$("#"+e+" .spin_add_article_in_devis_cmd").addClass("hide"),$("#"+e+" #importOCRbtn").removeClass("hide"),$("#"+e+" .spin_importOCRbtn").addClass("hide")})):($("#"+e+" #importOCRbtn").removeClass("hide"),$("#"+e+" .spin_importOCRbtn").addClass("hide"),$("#"+e+" .add_article_in_devis_cmd").removeClass("hide"),$("#"+e+" .spin_add_article_in_devis_cmd").addClass("hide")),initEmptyDatePicker($("#date_dmd, #date_exp")),initEmptyDatePicker($("#fact_date_livraison_commande, #"+e+" #date_livraison_commande")),$("#fact_heure_livraison_commande, #"+e+" #heure_livraison_commande").clockpicker({autoclose:!0})})),$("#delai_p").on("change",(function(){$("#autreDelaiDeP").is(":checked")?$("#input_other_delai").removeClass("hide"):$("#input_other_delai").addClass("hide")})),$("#delai_p_modif").on("change",(function(){$("#autreDelaiDeP_modif").is(":checked")?$("#input_other_delai_modif").removeClass("hide"):$("#input_other_delai_modif").addClass("hide")})),$("select.selectClient").on("select2:select",(function(){let e=$(this),t=e.attr("data-CLink"),a=e.parent().parent().parent().parent().parent().parent().attr("id");-1==e?e.removeAttr("disabled"):$.post(t,{idOfClient:$(this).select2("data")[0].id},(function(e){$("#"+a+" #contact_client").val(e.contact),$("#"+a+" #cat_client").val(e.tarification).prop("disabled",!0),$("#"+a+" #cmd_code_cli").val(e.code_cli),$(".code_cli").html(e.code_cli),$(".fb2c_code_cli").html(e.code_cli),$(".fb2b_cli").html(e.cli),$(".fb2c_cli").html(e.cli),$(".fb2c_cli2").html(e.cli),$(".bl_cli").html(e.cli),$("#"+a+" #rfa_pc").val(e.rfa),$("#"+a+" #rexp_pc").val(e.rExp),_rfa=e.rfa,_rExp=e.rExp,_tva=e.tva,0!==e.delai&&7!==e.delai&&15!==e.delai&&30!==e.delai&&60!==e.delai?($("#"+a+'  input[value="-1"]').prop("checked",!0),$("#"+a+" #input_other_delai").removeClass("hide"),$("#"+a+" #autre_delai_payement").val(e.delai)):$("#"+a+' input[value="'+e.delai+'"]').prop("checked",!0),politique_selection=$("#"+a+" select.politique"),adress_selection=$("#"+a+" select.lieu_livraison"),politique_selection.select2({data:e.politique?e.politique:[],multiple:!1,language:{noResults:function(){return pl=pLink,typedInSelect=event.target.value,"<div class='text-center'><span class='text-muted font-size-13'>Ooooo!!, pas de resultat! <i class='fas fa-smile'></i></span><br><button type='button' onclick='createThisQuickly(politique_selection, pl)' class='btn create_this_article btn-sm btn-success'>Nouvelle politique ?</button></div>"}},escapeMarkup:function(e){return e}}),adress_selection.select2({data:e.adress?e.adress:[],multiple:!1,language:{noResults:function(){return ll=lLink,typedInSelect=event.target.value,"<div class='text-center'><span class='text-muted font-size-13'>Ooooo!!, pas de resultat! <i class='fas fa-smile'></i></span><br><button type='button' onclick='createThisQuickly(adress_selection, ll)' class='btn create_this_article btn-sm btn-success'>Nouvelle adresse ?</button></div>"}},escapeMarkup:function(e){return e}}),updateInCmd(a)}))})),$(".add_article_in_devis_cmd").click((function(){let e=$(this).parent().parent().parent().attr("id");addCommandeEntry($("#"+e+" #article_in_devis_cmd"),e)})),$("#fact_date_livraison_commande").on("change",(function(){let e=$(this).val();$("#date_livraison_commande").val(e),$(".b2c_dl").html(e),$(".b2c_dl2").html(e),$(".dateLivr").html(e)})),$("#fact_heure_livraison_commande").on("change",(function(){let e=$(this).val();$("#heure_livraison_commande").val(e),$(".b2c-hl").html(e),$(".b2c-hl2").html(e),$(".heureLivr").html(e)})),$("#importOCRbtn").click((function(){let e=null;Dropzone.autoDiscover=!1,dropzoneExists("#import_ocr_form .dropzone")||(e=new Dropzone("#import_ocr_form .dropzone",{url:"x",paramName:"excel_file",maxFiles:1,timeout:0,addRemoveLinks:!0,acceptedFiles:"application/vnd.ms-excel, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",autoProcessQueue:!1}),e.options.dictDefaultMessage="Cliquez ou glisser votre fichier ici",e.options.dictFileTooBig="Fichier trop grand ({{filesize}}MiB). Max autorisé: {{maxFilesize}}Mo.",e.options.dictInvalidFileType="Vous ne pouvez pas importer ce type de fichier.",e.options.dictResponseError="Erreur au niveau du serveur, code: {{statusCode}}.",e.options.dictCancelUpload="Annuler l'import",e.options.dictCancelUploadConfirmation="Etes-vous sûr?",e.options.dictRemoveFile="Retirer le fichier",e.options.dictMaxFilesExceeded="Vous avez atteint le nombre max d'importation."),$(".btn_import_ocr").click((function(){readXlsxFile(e.files[0]).then((function(t){for(let e=0;e<t.length;e++){function a(a){t[e][0]==a.cyrus&&addCommandeEntry($("#article_in_devis_cmd"),"new_cmd_form",a,t[e])}listOfArticleCyrus.find(a)}e.removeAllFiles(),$("#modal_commande_ajout .add_article_in_devis_cmd").addClass("hide")}))}))}));var dateColonnePourLaFiltre=$("#dateColonnePourLaFiltre").val();$.fn.dataTable.ext.search.push((function(e,t,a){function l(e){if(void 0!==e){let t=e.split("/"),a=t[0],l=t[1],r=t[2];return new Date(r,l-1,a)}}let r=l(minDate.val()),i=l(maxDate.val()),n=l(t[dateColonnePourLaFiltre]);return!!(void 0===r&&void 0===i||isNaN(r.getDay())&&isNaN(i.getDay())||isNaN(r.getDay())&&n<=i||r<=n&&isNaN(i.getDay())||r<=n&&n<=i)})),minDate=initEmptyDatePicker($("#min")),maxDate=initEmptyDatePicker($("#max")),$("#min, #max, #dateColonnePourLaFiltre").on("apply.daterangepicker change",(function(){tableFacture.draw(),tableCommande.draw(),dateColonnePourLaFiltre=$("#dateColonnePourLaFiltre").val()})),$(document).ready((function(){tableFacture.draw(),tableCommande.draw()})),tableFacture.on("draw.dt",(function(){let e=tableFacture.rows({search:"applied"}).data(),t=e.length,a=0,l=0,r=0,i=0;for(let n=0;n<t;n++){let t=e[n][2],o=e[n][3],c=e[n][4],s=parseInt(e[n][13].replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(",",".").replace(",","."));a+=o.indexOf("preparer")>0?1:0,l+=t.indexOf("Oui")>0?1:0,r+=c.indexOf("recouvrer")>0?1:0,i+=s}$("#nb_searchResult").html(t),$("#nbprepa_searchResult").html(a),$("#nbavoir_searchResult").html(l),$("#nbrec_searchResult").html(r),$("#valeur_searchResult").html(format_number(i))})),tableCommande.on("draw.dt",(function(){let e=tableCommande.rows({search:"applied"}).data(),t=e.length,a=0,l=0,r=0;for(let i=0;i<t;i++){let t=e[i][1],n=parseInt(e[i][8].replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(",",".").replace(",",".")),o=parseInt(e[i][9].replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(" ","").replace(",",".").replace(",","."));a+=t.indexOf("Facturé")>0?1:0,l+=n,r+=o}$("#nbCMD_searchResult").html(t),$("#cmdfact_searchResult").html(a),$("#valCMD_searchResult").html(format_number(l)),$("#valcmdfact_searchResult").html(format_number(r))}));var listOfArticles=null;$('input[name="daterangepicker"]').daterangepicker(),$("#new_action").click((function(){let e=$(this).attr("data-link");$.post(e,{},(function(e){$("#article").select2({placeholder:"Choisir un ou plusieur article...",data:e,multiple:!0,language:{noResults:function(){return"Pas de resultat !"}},escapeMarkup:function(e){return e}})}))})),$(".modifAction").click((function(){let e=$(this).attr("data-link"),t={id:$(this).attr("dataCallId")},a=$(this).attr("data-url");$.post(e,(function(e){$("select#articlesModifS").select2({placeholder:"Choisir un ou plusieur article...",data:e,multiple:!0,language:{noResults:function(){return"Pas de resultat !"}},escapeMarkup:function(e){return e}})})),$.post(a,t,(function(e){$("#actionModifVal").val(e.resultAction.id),$(".title-act").val(e.resultAction.title),$(".start-act").val(e.resultAction.start),$(".end-act").val(e.resultAction.end),$(".observation-act").val(e.resultAction.observation),$(".categori-act").val(e.resultAction.categori),$(".color").val(e.resultAction.color);e.article.forEach((function(t){let a=indexOfArticle;indexOfArticle++,$(".action_modif").append('<tr class="removeAct"><td><input type="hidden" class="b2bInitial'+a+'" value="'+e.article[a].b2b+'"><input type="hidden" class="b2cInitial'+a+'" value="'+e.article[a].b2c+'"><input type="hidden" name="id['+a+'][id]" value="'+t.id+'"><p>'+t.designation+'</p></td><td><input type="hidden" class="PR" value="'+Math.round(t.pr)+'"><p>'+Math.round(t.pr)+'</p></td><td><input type="hidden" name="id['+a+'][pvMoyenne]" value="'+t.pvMoyenne+'"><p class="pvMoyenneArt">'+t.pvMoyenne+"</p></td><td><p>"+t.stockReel+'</p></td><td><input type="number" class="form-control tauxB2B RMB'+a+'" name="id['+a+'][remiseB2b]" value="'+t.remiseB2b+'" style="min-height: 35px; width: 120px" data-id="'+a+'"></td><td><input type="number" class="form-control tauxB2C RMC'+a+'" name="id['+a+'][remiseB2c]" value="'+t.remiseB2c+'" style="min-height: 35px; width: 120px" data-id="'+a+'"></td><td><input type="number" name="id['+a+'][remisePvB2b]" class="form-control RM1 remB2b'+a+'" data-id="'+a+'"  value="'+t.actionPvB2b+'" style="min-height: 35px; width: 120px"></td><td><input type="number" name="id['+a+'][remisePvB2c]" class="form-control RM2 remB2c'+a+'" data-id="'+a+'" value="'+t.actionPvB2c+'" style="min-height: 35px; width: 120px" ></td><td><input type="number" name="id['+a+'][QTE]" class="form-control QTE" data-id="'+a+'" value="'+t.qte+'" style="min-height: 35px; width: 120px"></td><td><input type="hidden" class="CAB2B" name="id['+a+'][CAB2B]" value="'+t.caB2b+'"><p class="caActionB2B'+a+'"> '+t.caB2b+' Ar</p></td><td><input type="hidden" class="CAB2C" name="id['+a+'][CAB2C]" value="'+t.caB2c+'"><p class="caActionB2C'+a+'"> '+t.caB2c+' Ar</p></td><td><input type="hidden" class="margeB2BInput'+a+'" name="id['+a+'][margeB2B]" value="'+t.margeB2b+'"><p class="margeB2B'+a+'">'+t.margeB2b+' Ar</p></td><td><input type="hidden" class="margeB2CInput'+a+'" name="id['+a+'][margeB2C]" value="'+t.margeB2c+'"><p class="margeB2C'+a+'">'+t.margeB2c+' Ar</p></td><td><div class="btn btn-outline-danger btn-sm remove_article_in_this" style="cursor: pointer;"><i class="ti-trash"></i></div></td></tr>')})),$(".remove_article_in_this").click((function(e){e.preventDefault(),$(this).parent().parent().remove()})),$(".tauxB2B").change((function(){let e=$(this).val(),t=$(this).attr("data-id"),a=$(".b2bInitial"+t).val(),l=a-a*e/100;$(".remB2b"+t).val(Math.round(l))})),$(".tauxB2C").change((function(){let e=$(this).val(),t=$(this).attr("data-id"),a=$(".b2cInitial"+t).val(),l=a-a*e/100;$(".remB2c"+t).val(Math.round(l))})),$(".RM1").change((function(){let e=$(".PR").val(),t=$(this).attr("data-id"),a=$(this).val(),l=100-100*a/$(".b2bInitial"+t).val(),r=$(".QTE").val(),i=a*r,n=r*(a-e);$(".RMB2B"+t).html(l.toFixed(2)+"%"),$(".RMB"+t).val(l.toFixed(2)),$(".caActionB2B"+t).html(i+"Ar"),$(".margeB2B"+t).html(n+"Ar"),$(".margeB2BInput"+t).val(n)})),$(".RM2").change((function(){let t=$(".PR").val(),a=$(this).attr("data-id"),l=$(this).val(),r=100-100*l/e.article[a].b2c,i=$(".QTE").val(),n=l*i,o=i*(l-t);$(".RMB2C"+a).html(r.toFixed(2)+"%"),$(".RMC"+a).val(r.toFixed(2)),$(".caActionB2C"+a).html(n+"Ar"),$(".margeB2C"+a).html(o+"Ar"),$(".margeB2CInput"+a).val(o)})),$(".QTE").change((function(){let e=$(this).attr("data-id"),t=$(this).val(),a=$(".PR").val(),l=$(".remB2b"+e).val(),r=$(".remB2c"+e).val(),i=l*t,n=r*t,o=t*(l-a),c=t*(r-a);$(".caActionB2B"+e).html(i+"Ar"),$(".caActionB2C"+e).html(n+"Ar"),$(".CAB2B").val(i),$(".CAB2C").val(n),$(".margeB2B"+e).html(o+"Ar"),$(".margeB2C"+e).html(c+"Ar"),$(".margeB2BInput"+e).val(o),$(".margeB2CInput"+e).val(c)}))}))})),$("#valider_recherche_action").click((function(){let e={data:$("#article").val()},t=$(this).attr("data-link");$.post(t,e,(function(e){$(".remiseTH").text(0),e.forEach((e=>{let t=indexOfArticle;indexOfArticle++,$("#action_creat").append('<tr><td><input type="hidden" name="id['+t+'][id]" value="'+e.id+'"><p>'+e.designation+'</p></td><td><input type="hidden" class="PR" value="'+Math.round(e.pr)+'"><p>'+Math.round(e.pr)+'</p></td><td><input type="hidden" name="id['+t+'][pvMoyenne]" value="'+e.pvMoyenne+'"><p class="pvMoyenneArt">'+e.pvMoyenne+"</p></td><td><p>"+e.stock+'</p></td><td><input type="number" class="form-control tauxB2B RMB'+t+'"  name="id['+t+'][remiseB2b]"  data-id="'+t+'" style="min-height: 35px; width: 120px" value="0"></td><td><input type="number" class="form-control tauxB2C RMC'+t+'"  name="id['+t+'][remiseB2c]"  data-id="'+t+'" style="min-height: 35px; width: 120px" value="0"></td><td><input type="number" name="id['+t+'][remisePvB2b]" class="form-control RM1 remB2b'+t+'" id="remB2b'+t+'" data-id="'+t+'" style="min-height: 35px; width: 120px" pvB2B="'+e.b2b+'" value="'+Math.round(e.b2b-0*e.b2b/100)+'"></td><td><input type="number" name="id['+t+'][remisePvB2c]" class="form-control RM2 remB2c'+t+'" id="remB2c'+t+'" data-id="'+t+'" style="min-height: 35px; width: 120px" pvB2C="'+e.b2c+'" value="'+Math.round(e.b2c-0*e.b2c/100)+'"></td><td><input type="number" name="id['+t+'][QTE]" class="form-control QTE" data-id="'+t+'" style="min-height: 35px; width: 120px" value="0"></td><td><input type="hidden" class="CAB2B" name="id['+t+'][CAB2B]" value="0"><p class="caActionB2B'+t+'"> 0 Ar</p></td><td><input type="hidden" class="CAB2C" name="id['+t+'][CAB2C]" value="0"><p class="caActionB2C'+t+'"> 0 Ar</p></td><td><input type="hidden" class="margeB2BInput'+t+'" name="id['+t+'][margeB2B]" value="0"><p class="margeB2B'+t+'">0</p></td><td><input type="hidden" class="margeB2CInput'+t+'" name="id['+t+'][margeB2C]" value="0"><p class="margeB2C'+t+'">0</p></td><td><div class="btn btn-outline-danger btn-sm remove_article_in_this" style="cursor: pointer;"><i class="ti-trash"></i></div></td></tr>')})),$(".remove_article_in_this").click((function(e){e.preventDefault(),$(this).parent().parent().remove()})),$(".tauxB2B").change((function(){let e=$(this).val(),t=$(this).attr("data-id"),a=$(".RM1").attr("pvB2B"),l=a-a*e/100;$(".remB2b"+t).val(Math.round(l))})),$(".tauxB2C").change((function(){let e=$(this).val(),t=$(this).attr("data-id"),a=$(".RM2").attr("pvB2C"),l=a-a*e/100;$(".remB2c"+t).val(Math.round(l))})),$(".RM1").change((function(){let t=$(".PR").val(),a=$(this).attr("data-id"),l=$(this).val(),r=100-100*l/e[a].b2b,i=$(".QTE").val(),n=l*i,o=i*(l-t);$(".RMB2B"+a).html(r.toFixed(2)+"%"),$(".RMB"+a).val(r.toFixed(2)),$(".caActionB2B"+a).html(n+"Ar"),$(".margeB2B"+a).html(o+"Ar"),$(".margeB2BInput"+a).val(o)})),$(".RM2").change((function(){let t=$(".PR").val(),a=$(this).attr("data-id"),l=$(this).val(),r=100-100*l/e[a].b2c,i=$(".QTE").val(),n=l*i,o=i*(l-t);$(".RMB2C"+a).html(r.toFixed(2)+"%"),$(".RMC"+a).val(r.toFixed(2)),$(".caActionB2C"+a).html(n+"Ar"),$(".margeB2C"+a).html(o+"Ar"),$(".margeB2CInput"+a).val(o)})),$(".QTE").change((function(){let e=$(this).attr("data-id"),t=$(this).val(),a=$(".PR").val(),l=$("#remB2b"+e).val(),r=$("#remB2c"+e).val(),i=l*t,n=r*t,o=t*(l-a),c=t*(r-a);$(".caActionB2B"+e).html(i+"Ar"),$(".caActionB2C"+e).html(n+"Ar"),$(".CAB2B").val(i),$(".CAB2C").val(n),$(".margeB2B"+e).html(o+"Ar"),$(".margeB2C"+e).html(c+"Ar"),$(".margeB2BInput"+e).val(o),$(".margeB2CInput"+e).val(c)}))}))})),$("#valider_recherche_action_modif").click((function(){let e={data:$("#articlesModifS").val()},t=$(this).attr("data-link");$.post(t,e,(function(e){$(".remiseTH").text(0),e.forEach((e=>{let t=indexOfArticle;indexOfArticle++,$(".action_modif").append('<tr class="removeAct"><td><input type="hidden" class="b2bInitial'+t+'" value="'+e.b2b+'"><input type="hidden" class="b2cInitial'+t+'" value="'+e.b2c+'"><input type="hidden" name="id['+t+'][id]" value="'+e.id+'"><p>'+e.designation+'</p></td><td><input type="hidden" class="PR" value="'+Math.round(e.pr)+'"><p>'+Math.round(e.pr)+'</p></td><td><input type="hidden" name="id['+t+'][pvMoyenne]" value="'+e.pvMoyenne+'"><p class="pvMoyenneArt">'+e.pvMoyenne+"</p></td><td><p>"+e.stock+'</p></td><td><input type="number" class="form-control tauxB2B RMB'+t+'"  name="id['+t+'][remiseB2b]"  data-id="'+t+'" style="min-height: 35px; width: 120px" value="0"></td><td><input type="number" class="form-control tauxB2C RMC'+t+'"  name="id['+t+'][remiseB2c]"  data-id="'+t+'" style="min-height: 35px; width: 120px" value="0"></td><td><input type="number" name="id['+t+'][remisePvB2b]" class="form-control RM1 remB2b'+t+'" id="remB2b'+t+'" data-id="'+t+'" style="min-height: 35px; width: 120px" pvB2B="'+e.b2b+'" value="'+Math.round(e.b2b-0*e.b2b/100)+'"></td><td><input type="number" name="id['+t+'][remisePvB2c]" class="form-control RM2 remB2c'+t+'" id="remB2c'+t+'" data-id="'+t+'" style="min-height: 35px; width: 120px" pvB2C="'+e.b2c+'" value="'+Math.round(e.b2c-0*e.b2c/100)+'"></td><td><input type="number" name="id['+t+'][QTE]" class="form-control" id="QTE" data-id="'+t+'" style="min-height: 35px; width: 120px" value="0"></td><td><input type="hidden" class="CAB2B" name="id['+t+'][CAB2B]" value="0"><p class="caActionB2B'+t+'"> 0 Ar</p></td><td><input type="hidden" class="CAB2C" name="id['+t+'][CAB2C]" value="0"><p class="caActionB2C'+t+'"> 0 Ar</p></td><td><input type="hidden" class="margeB2BInput'+t+'" name="id['+t+'][margeB2B]" value="0"><p class="margeB2B'+t+'">0</p></td><td><input type="hidden" class="margeB2CInput'+t+'" name="id['+t+'][margeB2C]" value="0"><p class="margeB2C'+t+'">0</p></td><td><div class="btn btn-outline-danger btn-sm remove_article_in_this" style="cursor: pointer;"><i class="ti-trash"></i></div></td></tr>')})),$(".remove_article_in_this").click((function(e){e.preventDefault(),$(this).parent().parent().remove()})),$(".tauxB2B").change((function(){let e=$(this).val(),t=$(this).attr("data-id"),a=$(".b2bInitial"+t).val(),l=a-a*e/100;$(".remB2b"+t).val(Math.round(l))})),$(".tauxB2C").change((function(){let e=$(this).val(),t=$(this).attr("data-id"),a=$(".b2cInitial"+t).val(),l=a-a*e/100;$(".remB2c"+t).val(Math.round(l))})),$(".RM1").change((function(){let e=$(".PR").val(),t=$(this).attr("data-id"),a=$(this).val(),l=100-100*a/$(".b2bInitial"+t).val(),r=$("#QTE").val(),i=a*r,n=r*(a-e);$(".RMB2B"+t).html(l.toFixed(2)+"%"),$(".RMB"+t).val(l.toFixed(2)),$(".caActionB2B"+t).html(i+"Ar"),$(".margeB2B"+t).html(n+"Ar"),$(".margeB2BInput"+t).val(n)})),$(".RM2").change((function(){let e=$(".PR").val(),t=$(this).attr("data-id"),a=$(this).val(),l=100-100*a/$(".b2cInitial"+t).val(),r=$("#QTE").val(),i=a*r,n=r*(a-e);$(".RMB2C"+t).html(l.toFixed(2)+"%"),$(".RMC"+t).val(l.toFixed(2)),$(".caActionB2C"+t).html(i+"Ar"),$(".margeB2C"+t).html(n+"Ar"),$(".margeB2CInput"+t).val(n)})),$("#QTE").change((function(){let e=$(this).attr("data-id"),t=$(this).val(),a=$(".PR").val(),l=$(".remB2b"+e).val(),r=$(".remB2c"+e).val(),i=l*t,n=r*t,o=t*(l-a),c=t*(r-a);$(".caActionB2B"+e).html(i+"Ar"),$(".caActionB2C"+e).html(n+"Ar"),$(".CAB2B").val(i),$(".CAB2C").val(n),$(".margeB2B"+e).html(o+"Ar"),$(".margeB2C"+e).html(c+"Ar"),$(".margeB2BInput"+e).val(o),$(".margeB2CInput"+e).val(c)}))}))})),$(".showActionOn").click((function(){const e=$(this).attr("data-link"),t=$(this).attr("data-target");$.get(e,(function(e){$(t+"_content").html(e)}))})),$('input[name="datePck-debut"], input[name="datePck-fin"]').daterangepicker({singleDatePicker:!0,showDropdowns:!0,locale:{cancelLabel:"Clear"}}),$("input.colorpicker-example").colorpicker({format:"hex"}),$("#calendar-form").on("submit",(function(e){e.preventDefault();let t=$(this).attr("data-link"),a={title:$("#title").val(),start:$("#start").val(),end:$("#end").val(),color:$("#color").val(),objectif:$("#objectif").val(),event:$("#event").val()};$("#modal_calendar_new").modal("hide"),$.post(t,a,(function(e){}))}));let xmlhttp=new XMLHttpRequest;xmlhttp.onreadystatechange=()=>{if(4==xmlhttp.readyState&&200==xmlhttp.status){let e=JSON.parse(xmlhttp.responseText);$("#calendrier").fullCalendar({locale:"fr",header:{left:"prev,next today",center:"title",right:"month,agendaWeek,listMonth,agendaDay"},buttonText:{today:"Aujourd'hui",month:"Mois",week:"Semaine",day:"Jours",list:"Année"},views:{listMonth:{type:"dayGrid",duration:{months:2},buttonText:"Deux mois"}},weekNumbers:!0,eventLimit:!0,events:e,eventRender:function(e,t){e.icon&&t.find(".fc-title").prepend("<i class='mr-1 fa fa-"+e.icon+"'></i>")}})}},xmlhttp.open("GET","/vente/action/eventsCall",!0),xmlhttp.send(null),$(".modif-calendar").click((function(){let e={id:$(".modif-calendar").attr("dataCallId")},t=$(this).attr("data-url");$(".modal_calendar_modif").modal("show"),$.post(t,e,(function(e){e.forEach((e=>{$(".title-call").val(e.title),$(".start-call").val(e.start),$(".end-call").val(e.end),$(".color-call").val(e.color),$(".objectif-call").val(e.objectif),$(".event-call").val(e.event),$("#validationModifCal").attr("data-url","/action/calendar/modif/"+e.id),$(".id-call").val(e.id)}))}))})),$("#calendar-form-modif").on("submit",(function(e){e.preventDefault(),url=$("#validationModifCal").attr("data-url"),data={id:$(".id-call").val(),title:$(".title-call").val(),start:$(".start-call").val(),end:$(".end-call").val(),color:$(".color-call").val(),objectif:$(".objectif-call").val(),event:$(".event-call").val()},$.post(url,data,(function(e){e.forEach((e=>{$(".modal_calendar_modif").modal("hide"),$(".title-calendar").html('<h5><i class="fa fa-circle color-calendar"></i>  '+e.title+"</h5>"),$(".start-calendar").html("<p>"+e.start+"</p>"),$(".end-calendar").html("<p>"+e.end+"</p>"),$(".objectif-calendar").html("<p>"+e.objectif+"</p>"),$(".event-calendar").html("<p>"+e.event+"</p>"),$(".color-calendar").css("color",e.backgroundColor),$(".modif-calendar").attr("data-url","/vente/action/calendar/showOne/"),$(".modif-calendar").attr("dataCallId",e.id)}))}))})),$("#creation-action").on("submit",(function(e){e.preventDefault();$(".designation").text(),$(".b2b").text(),$(".b2b-remise").val(),$(".b2c").text(),$(".b2c-remise").val(),$(".title-action").val()})),$((function(){const e="Veuillez remplire ce champ SVP",t="Champ obligatoire",a="Veuillez remplire ce champ par des nombres SVP";$.validator.setDefaults({errorClass:"invalid-feedback",validClass:"valid-feedback",highlight:function(e){$(e).siblings(".error").removeClass("valid-feedback").addClass("invalid-feedback"),$(e).addClass("is-invalid").removeClass("is-valid")},unhighlight:function(e){$(e).siblings(".error").addClass("valid-feedback").removeClass("invalid-feedback"),$(e).removeClass("is-invalid").addClass("is-valid")}}),$("#validationFrn").validate({rules:{"fournisseur[designation]":{required:!0},"fournisseur[pays]":{required:!0}},messages:{"fournisseur[designation]":{required:e},"fournisseur[pays]":{required:e}}}),$("#validationTrans").validate({rules:{"transitaire[designation]":{required:!0},"transitaire[tarif_avion]":{required:!0,number:!0},"transitaire[tarif_bateau]":{required:!0,number:!0}},messages:{"transitaire[designation]":{required:e},"transitaire[tarif_avion]":{required:a},"transitaire[tarif_bateau]":{required:a}}}),$("#validationUnite").validate({rules:{"unite[unite]":{required:!0}},messages:{"unite[unite]":{required:e}}}),$("#validationPayment").validate({rules:{"payement[mode]":{required:!0}},messages:{"payement[mode]":{required:e}}}),$("#validationFamille").validate({rules:{"famille[famille]":{required:!0}},messages:{"famille[famille]":{required:e}}}),$("#validationType").validate({rules:{"type_article[type]":{required:!0}},messages:{"type_article[type]":{required:e}}}),$("#validationDevise").validate({rules:{"devise[devise]":{required:!0},"devise[sign]":{required:!0},add_actual_cours:{required:!0,number:!0}},messages:{"devise[devise]":{required:a},"devise[sign]":{required:e},add_actual_cours:{required:a}}}),$("#import_fournisseur_form").validate({rules:{date_achat:{required:!0},"achat_local[ref_fact_frn]":{required:!0},avance:{required:!0,number:!0}},messages:{date_achat:{required:t},"achat_local[ref_fact_frn]":{required:t},avance:{required:a}}}),$("#validationFormExt").validate({rules:{date_achat:{required:!0},"bon_de_commande[devise]":{required:!0},"bon_de_commande[ref_fact_frn]":{required:!0},acompte_paye:{required:!0,number:!0}},messages:{date_achat:{required:t},"bon_de_commande[devise]":{required:t},"bon_de_commande[ref_fact_frn]":{required:t},acompte_paye:{required:a,number:"Veillez remplir par des nombres valide s'il vous plait"}}}),$("#validation_import_excel").validate({rules:{import_fournisseur:{required:!0}},messages:{import_fournisseur:{required:"Choisisez un fichier excel SVP"}}}),$("#creationUser").validate({rules:{"user[password]":{required:!0,minlength:3},"user[pseudo]":{required:!0},"user[nom]":{required:!0},"user[prenom]":{required:!0},"user[poste]":{required:!0}},messages:{"user[password]":{required:"le champ ne doit pa être vide",minlength:"le mot de passe doit avoir au minimum 3 caractères"},"user[pseudo]":{required:"le champ ne doit pa être vide"},"user[nom]":{required:"le champ ne doit pa être vide"},"user[prenom]":{required:"le champ ne doit pa être vide"},"user[poste]":{required:"le champ ne doit pa être vide"}}}),$("#modifpass").validate({rules:{pass:{required:!0,minlength:3},repeatPassModif:{equalTo:'[name="pass"]'}},messages:{pass:{required:"le champ ne doit pa être vide",minlength:"le mot de passe doit avoir au minimum 3 caractères"},repeatPassModif:{equalTo:"le mots doit être identique"}}}),$("#new_cmd_form").validate({rules:{cat_client:{required:!0},contact_client:{required:!0},mode_payement:{required:!0},date_livraison_commande:{required:!0},lieu_livraison:{required:!0}},messages:{cat_client:{required:t},contact_client:{required:t},mode_payement:{required:t},date_livraison_commande:{required:t},lieu_livraison:{required:t}}}),$("#new_devis_form").validate({rules:{cat_client:{required:!0},contact_client:{required:!0},mode_payement:{required:!0},date_dmd:{required:!0},date_exp:{required:!0},lieu_livraison:{required:!0}},messages:{cat_client:{required:t},contact_client:{required:t},mode_payement:{required:t},date_dmd:{required:t},date_exp:{required:t},lieu_livraison:{required:t}}}),$(".closeModifPass").on("click",(function(){$("#passdModif").val(""),$("#repeatPassModif").val("")}))}));